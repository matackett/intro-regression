<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> 10 Intro to R | Intro to Regression Analysis</title>
  <meta name="description" content="This document contains lab assignments and other materials for an intermediate-level regression course.">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content=" 10 Intro to R | Intro to Regression Analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This document contains lab assignments and other materials for an intermediate-level regression course." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content=" 10 Intro to R | Intro to Regression Analysis" />
  
  <meta name="twitter:description" content="This document contains lab assignments and other materials for an intermediate-level regression course." />
  

<meta name="author" content="Maria Tackett">


<meta name="date" content="2019-05-14">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="special.html">
<link rel="next" href="data.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Broadening Your Statistical Horizons</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Beginning of the Book</a></li>
<li class="chapter" data-level="2" data-path="getstarted.html"><a href="getstarted.html"><i class="fa fa-check"></i><b>2</b> Getting Started</a></li>
<li class="chapter" data-level="3" data-path="slr.html"><a href="slr.html"><i class="fa fa-check"></i><b>3</b> Simple Linear Regression</a><ul>
<li class="chapter" data-level="3.1" data-path="slr.html"><a href="slr.html#computing-college-admissions"><i class="fa fa-check"></i><b>3.1</b> Computing: College Admissions</a><ul>
<li class="chapter" data-level="3.1.1" data-path="slr.html"><a href="slr.html#packages"><i class="fa fa-check"></i><b>3.1.1</b> Packages</a></li>
<li class="chapter" data-level="3.1.2" data-path="slr.html"><a href="slr.html#data"><i class="fa fa-check"></i><b>3.1.2</b> Data</a></li>
<li class="chapter" data-level="3.1.3" data-path="slr.html"><a href="slr.html#exercises"><i class="fa fa-check"></i><b>3.1.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="slr.html"><a href="slr.html#in-class-exercise-advertising-analysis"><i class="fa fa-check"></i><b>3.2</b> In-Class Exercise: Advertising Analysis</a><ul>
<li class="chapter" data-level="3.2.1" data-path="slr.html"><a href="slr.html#data-and-packages"><i class="fa fa-check"></i><b>3.2.1</b> Data and packages</a></li>
<li class="chapter" data-level="3.2.2" data-path="slr.html"><a href="slr.html#analysis"><i class="fa fa-check"></i><b>3.2.2</b> Analysis</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="slr.html"><a href="slr.html#in-class-exercise-beer-data-analysis"><i class="fa fa-check"></i><b>3.3</b> In-Class Exercise: Beer Data Analysis</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="anova.html"><a href="anova.html"><i class="fa fa-check"></i><b>4</b> Analysis of Variance</a></li>
<li class="chapter" data-level="5" data-path="mlr.html"><a href="mlr.html"><i class="fa fa-check"></i><b>5</b> Multiple Linear Regression</a></li>
<li class="chapter" data-level="6" data-path="select.html"><a href="select.html"><i class="fa fa-check"></i><b>6</b> Model Selection</a></li>
<li class="chapter" data-level="7" data-path="logistic.html"><a href="logistic.html"><i class="fa fa-check"></i><b>7</b> Logistic Regression</a></li>
<li class="chapter" data-level="8" data-path="multinom-logistic.html"><a href="multinom-logistic.html"><i class="fa fa-check"></i><b>8</b> Multinomial Logistic Regression</a></li>
<li class="chapter" data-level="9" data-path="special.html"><a href="special.html"><i class="fa fa-check"></i><b>9</b> Special Topics</a></li>
<li class="part"><span><b>Computing Assignments</b></span></li>
<li class="chapter" data-level="10" data-path="intro-to-r.html"><a href="intro-to-r.html"><i class="fa fa-check"></i><b>10</b> Intro to R</a><ul>
<li class="chapter" data-level="10.1" data-path="intro-to-r.html"><a href="intro-to-r.html#introduction"><i class="fa fa-check"></i><b>10.1</b> Introduction</a><ul>
<li class="chapter" data-level="10.1.1" data-path="intro-to-r.html"><a href="intro-to-r.html#topics-covered-in-this-lab"><i class="fa fa-check"></i><b>10.1.1</b> Topics covered in this lab:</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="intro-to-r.html"><a href="intro-to-r.html#packages-1"><i class="fa fa-check"></i><b>10.2</b> Packages</a></li>
<li class="chapter" data-level="10.3" data-path="intro-to-r.html"><a href="intro-to-r.html#warm-up"><i class="fa fa-check"></i><b>10.3</b> Warm up</a></li>
<li class="chapter" data-level="10.4" data-path="intro-to-r.html"><a href="intro-to-r.html#project-name"><i class="fa fa-check"></i><b>10.4</b> Project name:</a><ul>
<li class="chapter" data-level="10.4.1" data-path="intro-to-r.html"><a href="intro-to-r.html#yaml"><i class="fa fa-check"></i><b>10.4.1</b> YAML:</a></li>
<li class="chapter" data-level="10.4.2" data-path="intro-to-r.html"><a href="intro-to-r.html#commiting-changes"><i class="fa fa-check"></i><b>10.4.2</b> Commiting changes:</a></li>
<li class="chapter" data-level="10.4.3" data-path="intro-to-r.html"><a href="intro-to-r.html#pushing-changes"><i class="fa fa-check"></i><b>10.4.3</b> Pushing changes:</a></li>
<li class="chapter" data-level="10.4.4" data-path="intro-to-r.html"><a href="intro-to-r.html#data-1"><i class="fa fa-check"></i><b>10.4.4</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="intro-to-r.html"><a href="intro-to-r.html#exercises-1"><i class="fa fa-check"></i><b>10.5</b> Exercises</a><ul>
<li class="chapter" data-level="10.5.1" data-path="intro-to-r.html"><a href="intro-to-r.html#visualizing-your-data"><i class="fa fa-check"></i><b>10.5.1</b> Visualizing Your Data</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="intro-to-r.html"><a href="intro-to-r.html#simple-linear-regression-1"><i class="fa fa-check"></i><b>10.6</b> Simple Linear Regression</a></li>
<li class="chapter" data-level="10.7" data-path="intro-to-r.html"><a href="intro-to-r.html#computing-college-admissions-1"><i class="fa fa-check"></i><b>10.7</b> Computing: College Admissions</a><ul>
<li class="chapter" data-level="10.7.1" data-path="intro-to-r.html"><a href="intro-to-r.html#packages-2"><i class="fa fa-check"></i><b>10.7.1</b> Packages</a></li>
<li class="chapter" data-level="10.7.2" data-path="intro-to-r.html"><a href="intro-to-r.html#data-2"><i class="fa fa-check"></i><b>10.7.2</b> Data</a></li>
<li class="chapter" data-level="10.7.3" data-path="intro-to-r.html"><a href="intro-to-r.html#exercises-2"><i class="fa fa-check"></i><b>10.7.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="anova.html"><a href="anova.html#anova"><i class="fa fa-check"></i><b>10.8</b> ANOVA</a><ul>
<li class="chapter" data-level="10.8.1" data-path="intro-to-r.html"><a href="intro-to-r.html#packages-3"><i class="fa fa-check"></i><b>10.8.1</b> Packages</a></li>
<li class="chapter" data-level="10.8.2" data-path="intro-to-r.html"><a href="intro-to-r.html#data-3"><i class="fa fa-check"></i><b>10.8.2</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="10.9" data-path="intro-to-r.html"><a href="intro-to-r.html#exercises-3"><i class="fa fa-check"></i><b>10.9</b> Exercises</a></li>
<li class="chapter" data-level="10.10" data-path="intro-to-r.html"><a href="intro-to-r.html#multiple-linear-regression"><i class="fa fa-check"></i><b>10.10</b> Multiple Linear Regression</a><ul>
<li class="chapter" data-level="10.10.1" data-path="intro-to-r.html"><a href="intro-to-r.html#packages-4"><i class="fa fa-check"></i><b>10.10.1</b> Packages</a></li>
<li class="chapter" data-level="10.10.2" data-path="intro-to-r.html"><a href="intro-to-r.html#data-4"><i class="fa fa-check"></i><b>10.10.2</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="10.11" data-path="intro-to-r.html"><a href="intro-to-r.html#exercises-4"><i class="fa fa-check"></i><b>10.11</b> Exercises</a><ul>
<li class="chapter" data-level="10.11.1" data-path="intro-to-r.html"><a href="intro-to-r.html#acknowledgement"><i class="fa fa-check"></i><b>10.11.1</b> Acknowledgement</a></li>
</ul></li>
<li class="chapter" data-level="10.12" data-path="intro-to-r.html"><a href="intro-to-r.html#data-wrangling-multiple-linear-regression"><i class="fa fa-check"></i><b>10.12</b> Data Wrangling &amp; Multiple Linear Regression</a><ul>
<li class="chapter" data-level="10.12.1" data-path="intro-to-r.html"><a href="intro-to-r.html#packages-5"><i class="fa fa-check"></i><b>10.12.1</b> Packages</a></li>
<li class="chapter" data-level="10.12.2" data-path="intro-to-r.html"><a href="intro-to-r.html#data-5"><i class="fa fa-check"></i><b>10.12.2</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="10.13" data-path="intro-to-r.html"><a href="intro-to-r.html#exercises-5"><i class="fa fa-check"></i><b>10.13</b> Exercises</a><ul>
<li class="chapter" data-level="10.13.1" data-path="intro-to-r.html"><a href="intro-to-r.html#data-wrangling"><i class="fa fa-check"></i><b>10.13.1</b> Data wrangling</a></li>
<li class="chapter" data-level="10.13.2" data-path="intro-to-r.html"><a href="intro-to-r.html#regression-analysis"><i class="fa fa-check"></i><b>10.13.2</b> Regression Analysis</a></li>
<li class="chapter" data-level="10.13.3" data-path="intro-to-r.html"><a href="intro-to-r.html#acknowledgement-1"><i class="fa fa-check"></i><b>10.13.3</b> Acknowledgement</a></li>
</ul></li>
<li class="chapter" data-level="10.14" data-path="intro-to-r.html"><a href="intro-to-r.html#model-selection"><i class="fa fa-check"></i><b>10.14</b> Model Selection</a><ul>
<li class="chapter" data-level="10.14.1" data-path="intro-to-r.html"><a href="intro-to-r.html#packages-6"><i class="fa fa-check"></i><b>10.14.1</b> Packages</a></li>
<li class="chapter" data-level="10.14.2" data-path="intro-to-r.html"><a href="intro-to-r.html#data-6"><i class="fa fa-check"></i><b>10.14.2</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="10.15" data-path="intro-to-r.html"><a href="intro-to-r.html#exercises-6"><i class="fa fa-check"></i><b>10.15</b> Exercises</a><ul>
<li class="chapter" data-level="10.15.1" data-path="intro-to-r.html"><a href="intro-to-r.html#part-i-1"><i class="fa fa-check"></i><b>10.15.1</b> Part I</a></li>
<li class="chapter" data-level="10.15.2" data-path="intro-to-r.html"><a href="intro-to-r.html#part-ii-1"><i class="fa fa-check"></i><b>10.15.2</b> Part II</a></li>
<li class="chapter" data-level="10.15.3" data-path="intro-to-r.html"><a href="intro-to-r.html#acknowledgements"><i class="fa fa-check"></i><b>10.15.3</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="10.16" data-path="intro-to-r.html"><a href="intro-to-r.html#logistic-regression"><i class="fa fa-check"></i><b>10.16</b> Logistic Regression</a><ul>
<li class="chapter" data-level="10.16.1" data-path="intro-to-r.html"><a href="intro-to-r.html#packages-7"><i class="fa fa-check"></i><b>10.16.1</b> Packages</a></li>
<li class="chapter" data-level="10.16.2" data-path="intro-to-r.html"><a href="intro-to-r.html#data-7"><i class="fa fa-check"></i><b>10.16.2</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="10.17" data-path="intro-to-r.html"><a href="intro-to-r.html#exercises-7"><i class="fa fa-check"></i><b>10.17</b> Exercises</a><ul>
<li class="chapter" data-level="10.17.1" data-path="intro-to-r.html"><a href="intro-to-r.html#exploratory-data-analysis-2"><i class="fa fa-check"></i><b>10.17.1</b> Exploratory Data Analysis</a></li>
<li class="chapter" data-level="10.17.2" data-path="intro-to-r.html"><a href="intro-to-r.html#part-ii-logistic-regression-model"><i class="fa fa-check"></i><b>10.17.2</b> Part II: Logistic Regression Model</a></li>
<li class="chapter" data-level="10.17.3" data-path="intro-to-r.html"><a href="intro-to-r.html#part-iii-model-assessment"><i class="fa fa-check"></i><b>10.17.3</b> Part III: Model Assessment</a></li>
<li class="chapter" data-level="10.17.4" data-path="intro-to-r.html"><a href="intro-to-r.html#part-iv-prediction"><i class="fa fa-check"></i><b>10.17.4</b> Part IV: Prediction</a></li>
</ul></li>
<li class="chapter" data-level="10.18" data-path="intro-to-r.html"><a href="intro-to-r.html#multinomial-logistic-regression"><i class="fa fa-check"></i><b>10.18</b> Multinomial Logistic Regression</a><ul>
<li class="chapter" data-level="10.18.1" data-path="intro-to-r.html"><a href="intro-to-r.html#packages-8"><i class="fa fa-check"></i><b>10.18.1</b> Packages</a></li>
<li class="chapter" data-level="10.18.2" data-path="intro-to-r.html"><a href="intro-to-r.html#data-8"><i class="fa fa-check"></i><b>10.18.2</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="10.19" data-path="intro-to-r.html"><a href="intro-to-r.html#exercises-8"><i class="fa fa-check"></i><b>10.19</b> Exercises</a><ul>
<li class="chapter" data-level="10.19.1" data-path="intro-to-r.html"><a href="intro-to-r.html#part-i-exploratory-data-analysis"><i class="fa fa-check"></i><b>10.19.1</b> Part I: Exploratory Data Analysis</a></li>
<li class="chapter" data-level="10.19.2" data-path="intro-to-r.html"><a href="intro-to-r.html#part-ii-multinomial-logistic-regression-model"><i class="fa fa-check"></i><b>10.19.2</b> Part II: Multinomial Logistic Regression Model</a></li>
<li class="chapter" data-level="10.19.3" data-path="intro-to-r.html"><a href="intro-to-r.html#part-iii-model-fit"><i class="fa fa-check"></i><b>10.19.3</b> Part III: Model Fit</a></li>
<li class="chapter" data-level="10.19.4" data-path="intro-to-r.html"><a href="intro-to-r.html#part-iv-using-the-model"><i class="fa fa-check"></i><b>10.19.4</b> Part IV: Using the Model</a></li>
<li class="chapter" data-level="10.19.5" data-path="intro-to-r.html"><a href="intro-to-r.html#acknowledgements-1"><i class="fa fa-check"></i><b>10.19.5</b> Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="10.20" data-path="intro-to-r.html"><a href="intro-to-r.html#putting-it-all-together"><i class="fa fa-check"></i><b>10.20</b> Putting It All Together</a><ul>
<li class="chapter" data-level="10.20.1" data-path="intro-to-r.html"><a href="intro-to-r.html#packages-9"><i class="fa fa-check"></i><b>10.20.1</b> Packages</a></li>
<li class="chapter" data-level="10.20.2" data-path="intro-to-r.html"><a href="intro-to-r.html#data-9"><i class="fa fa-check"></i><b>10.20.2</b> Data</a></li>
<li class="chapter" data-level="10.20.3" data-path="intro-to-r.html"><a href="intro-to-r.html#exercises-9"><i class="fa fa-check"></i><b>10.20.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.21" data-path="intro-to-r.html"><a href="intro-to-r.html#movies-analysis"><i class="fa fa-check"></i><b>10.21</b> Movies Analysis</a></li>
<li class="chapter" data-level="10.22" data-path="intro-to-r.html"><a href="intro-to-r.html#data-10"><i class="fa fa-check"></i><b>10.22</b> Data</a></li>
<li class="chapter" data-level="10.23" data-path="intro-to-r.html"><a href="intro-to-r.html#analysis-1"><i class="fa fa-check"></i><b>10.23</b> Analysis</a><ul>
<li class="chapter" data-level="10.23.1" data-path="intro-to-r.html"><a href="intro-to-r.html#part-1"><i class="fa fa-check"></i><b>10.23.1</b> Part 1</a></li>
<li class="chapter" data-level="10.23.2" data-path="intro-to-r.html"><a href="intro-to-r.html#part-2"><i class="fa fa-check"></i><b>10.23.2</b> Part 2</a></li>
</ul></li>
<li class="chapter" data-level="10.24" data-path="intro-to-r.html"><a href="intro-to-r.html#next-steps"><i class="fa fa-check"></i><b>10.24</b> Next Steps</a></li>
<li class="chapter" data-level="10.25" data-path="intro-to-r.html"><a href="intro-to-r.html#discussion-questions"><i class="fa fa-check"></i><b>10.25</b> Discussion Questions</a></li>
<li class="chapter" data-level="10.26" data-path="intro-to-r.html"><a href="intro-to-r.html#references"><i class="fa fa-check"></i><b>10.26</b> References</a></li>
<li class="chapter" data-level="10.27" data-path="intro-to-r.html"><a href="intro-to-r.html#appendix"><i class="fa fa-check"></i><b>10.27</b> Appendix</a></li>
<li class="chapter" data-level="10.28" data-path="intro-to-r.html"><a href="intro-to-r.html#in-class-exercise-advertising-analysis-1"><i class="fa fa-check"></i><b>10.28</b> In-Class Exercise: Advertising Analysis</a><ul>
<li class="chapter" data-level="10.28.1" data-path="intro-to-r.html"><a href="intro-to-r.html#data-and-packages-1"><i class="fa fa-check"></i><b>10.28.1</b> Data and packages</a></li>
<li class="chapter" data-level="10.28.2" data-path="intro-to-r.html"><a href="intro-to-r.html#analysis-2"><i class="fa fa-check"></i><b>10.28.2</b> Analysis</a></li>
</ul></li>
<li class="chapter" data-level="10.29" data-path="intro-to-r.html"><a href="intro-to-r.html#in-class-exercise-beer-data-analysis-1"><i class="fa fa-check"></i><b>10.29</b> In-Class Exercise: Beer Data Analysis</a></li>
<li class="chapter" data-level="10.30" data-path="intro-to-r.html"><a href="intro-to-r.html#analyzing-wages"><i class="fa fa-check"></i><b>10.30</b> Analyzing Wages</a><ul>
<li class="chapter" data-level="10.30.1" data-path="intro-to-r.html"><a href="intro-to-r.html#initial-model"><i class="fa fa-check"></i><b>10.30.1</b> Initial model</a></li>
<li class="chapter" data-level="10.30.2" data-path="intro-to-r.html"><a href="intro-to-r.html#model-with-mean-centered-variables"><i class="fa fa-check"></i><b>10.30.2</b> Model with mean-centered variables</a></li>
<li class="chapter" data-level="10.30.3" data-path="intro-to-r.html"><a href="intro-to-r.html#model-with-indicator-variables"><i class="fa fa-check"></i><b>10.30.3</b> Model with indicator variables</a></li>
</ul></li>
<li class="chapter" data-level="10.31" data-path="intro-to-r.html"><a href="intro-to-r.html#exam-01-review"><i class="fa fa-check"></i><b>10.31</b> Exam 01 Review</a><ul>
<li class="chapter" data-level="10.31.1" data-path="intro-to-r.html"><a href="intro-to-r.html#main-effects-model"><i class="fa fa-check"></i><b>10.31.1</b> Main Effects Model</a></li>
</ul></li>
<li class="chapter" data-level="10.32" data-path="intro-to-r.html"><a href="intro-to-r.html#model-with-interactions"><i class="fa fa-check"></i><b>10.32</b> Model with Interactions</a></li>
<li class="chapter" data-level="10.33" data-path="intro-to-r.html"><a href="intro-to-r.html#model-selection-1"><i class="fa fa-check"></i><b>10.33</b> Model Selection</a></li>
<li class="chapter" data-level="10.34" data-path="intro-to-r.html"><a href="intro-to-r.html#backward-selection-manually"><i class="fa fa-check"></i><b>10.34</b> Backward selection “manually”</a></li>
<li class="chapter" data-level="10.35" data-path="intro-to-r.html"><a href="intro-to-r.html#backward-selection-using-regsubsets"><i class="fa fa-check"></i><b>10.35</b> Backward selection using regsubsets</a></li>
<li class="chapter" data-level="10.36" data-path="intro-to-r.html"><a href="intro-to-r.html#changing-selection-criteria"><i class="fa fa-check"></i><b>10.36</b> Changing selection criteria</a></li>
<li class="chapter" data-level="10.37" data-path="intro-to-r.html"><a href="intro-to-r.html#different-selection-procedure"><i class="fa fa-check"></i><b>10.37</b> Different selection procedure</a></li>
<li class="chapter" data-level="10.38" data-path="intro-to-r.html"><a href="intro-to-r.html#choosing-a-final-model"><i class="fa fa-check"></i><b>10.38</b> Choosing a final model</a></li>
<li class="chapter" data-level="10.39" data-path="intro-to-r.html"><a href="intro-to-r.html#logistic-regression-1"><i class="fa fa-check"></i><b>10.39</b> Logistic Regression</a></li>
<li class="chapter" data-level="10.40" data-path="intro-to-r.html"><a href="intro-to-r.html#references-1"><i class="fa fa-check"></i><b>10.40</b> References</a></li>
<li class="chapter" data-level="10.41" data-path="intro-to-r.html"><a href="intro-to-r.html#multinomial-logistic-regression-1"><i class="fa fa-check"></i><b>10.41</b> Multinomial Logistic Regression</a><ul>
<li class="chapter" data-level="10.41.1" data-path="intro-to-r.html"><a href="intro-to-r.html#questions"><i class="fa fa-check"></i><b>10.41.1</b> Questions</a></li>
<li class="chapter" data-level="10.41.2" data-path="intro-to-r.html"><a href="intro-to-r.html#references-2"><i class="fa fa-check"></i><b>10.41.2</b> References</a></li>
</ul></li>
<li class="chapter" data-level="10.42" data-path="intro-to-r.html"><a href="intro-to-r.html#dealing-with-missing-data"><i class="fa fa-check"></i><b>10.42</b> Dealing with Missing Data</a></li>
<li class="chapter" data-level="10.43" data-path="intro-to-r.html"><a href="intro-to-r.html#matrix-form-of-linear-regression"><i class="fa fa-check"></i><b>10.43</b> Matrix Form of Linear Regression</a></li>
<li class="chapter" data-level="10.44" data-path="intro-to-r.html"><a href="intro-to-r.html#introduction-1"><i class="fa fa-check"></i><b>10.44</b> Introduction</a></li>
<li class="chapter" data-level="10.45" data-path="intro-to-r.html"><a href="intro-to-r.html#matrix-form-for-the-regression-model"><i class="fa fa-check"></i><b>10.45</b> Matrix Form for the Regression Model</a></li>
<li class="chapter" data-level="10.46" data-path="intro-to-r.html"><a href="intro-to-r.html#estimating-the-coefficients"><i class="fa fa-check"></i><b>10.46</b> Estimating the Coefficients</a></li>
<li class="chapter" data-level="10.47" data-path="intro-to-r.html"><a href="intro-to-r.html#variance-covariance-matrix-of-the-coefficients"><i class="fa fa-check"></i><b>10.47</b> Variance-covariance matrix of the coefficients</a></li>
<li class="chapter" data-level="10.48" data-path="intro-to-r.html"><a href="intro-to-r.html#log-transformations-in-linear-regression"><i class="fa fa-check"></i><b>10.48</b> Log Transformations in Linear Regression</a></li>
<li class="chapter" data-level="10.49" data-path="intro-to-r.html"><a href="intro-to-r.html#log-transformation-on-the-response-variable"><i class="fa fa-check"></i><b>10.49</b> Log-transformation on the response variable</a><ul>
<li class="chapter" data-level="10.49.1" data-path="intro-to-r.html"><a href="intro-to-r.html#mean-median-and-log-transformations"><i class="fa fa-check"></i><b>10.49.1</b> Mean, Median, and Log Transformations</a></li>
<li class="chapter" data-level="10.49.2" data-path="intro-to-r.html"><a href="intro-to-r.html#interpretaton-of-model-coefficients"><i class="fa fa-check"></i><b>10.49.2</b> Interpretaton of model coefficients</a></li>
</ul></li>
<li class="chapter" data-level="10.50" data-path="intro-to-r.html"><a href="intro-to-r.html#log-transformation-on-the-predictor-variable"><i class="fa fa-check"></i><b>10.50</b> Log-transformation on the predictor variable</a></li>
<li class="chapter" data-level="10.51" data-path="intro-to-r.html"><a href="intro-to-r.html#log-transformation-on-the-the-response-and-predictor-variable"><i class="fa fa-check"></i><b>10.51</b> Log-transformation on the the response and predictor variable</a></li>
<li class="chapter" data-level="10.52" data-path="intro-to-r.html"><a href="intro-to-r.html#details-about-model-diagnostics"><i class="fa fa-check"></i><b>10.52</b> Details about Model Diagnostics</a></li>
<li class="chapter" data-level="10.53" data-path="intro-to-r.html"><a href="intro-to-r.html#introduction-2"><i class="fa fa-check"></i><b>10.53</b> Introduction</a></li>
<li class="chapter" data-level="10.54" data-path="intro-to-r.html"><a href="intro-to-r.html#matrix-form-for-the-regression-model-1"><i class="fa fa-check"></i><b>10.54</b> Matrix Form for the Regression Model</a></li>
<li class="chapter" data-level="10.55" data-path="intro-to-r.html"><a href="intro-to-r.html#hat-matrix-leverage"><i class="fa fa-check"></i><b>10.55</b> Hat Matrix &amp; Leverage</a></li>
<li class="chapter" data-level="10.56" data-path="intro-to-r.html"><a href="intro-to-r.html#standardized-residuals"><i class="fa fa-check"></i><b>10.56</b> Standardized Residuals</a></li>
<li class="chapter" data-level="10.57" data-path="intro-to-r.html"><a href="intro-to-r.html#cooks-distance"><i class="fa fa-check"></i><b>10.57</b> Cook’s Distance</a></li>
<li class="chapter" data-level="10.58" data-path="intro-to-r.html"><a href="intro-to-r.html#model-selection-criteria-aic-bic"><i class="fa fa-check"></i><b>10.58</b> Model Selection Criteria: AIC &amp; BIC</a></li>
<li class="chapter" data-level="10.59" data-path="intro-to-r.html"><a href="intro-to-r.html#maximum-likelihood-estimation-of-boldsymbolbeta-and-sigma"><i class="fa fa-check"></i><b>10.59</b> Maximum Likelihood Estimation of <span class="math inline">\(\boldsymbol{\beta}\)</span> and <span class="math inline">\(\sigma\)</span></a></li>
<li class="chapter" data-level="10.60" data-path="intro-to-r.html"><a href="intro-to-r.html#aic"><i class="fa fa-check"></i><b>10.60</b> AIC</a></li>
<li class="chapter" data-level="10.61" data-path="intro-to-r.html"><a href="intro-to-r.html#bic"><i class="fa fa-check"></i><b>10.61</b> BIC</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="slr.html"><a href="slr.html#data"><i class="fa fa-check"></i><b>11</b> Data Sets</a></li>
<li class="chapter" data-level="12" data-path="refs.html"><a href="refs.html"><i class="fa fa-check"></i><b>12</b> References</a></li>
<li class="chapter" data-level="13" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>13</b> Introduction</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intro to Regression Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="intro-to-r" class="section level1">
<h1><span class="header-section-number"> 10</span> Intro to R</h1>
<div id="introduction" class="section level2">
<h2><span class="header-section-number">10.1</span> Introduction</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># R is the name of the programming language itself and RStudio is a convenient interface.</span></code></pre></div>
<p>The main goal of this lab is to introduce you to R and RStudio, which we will be using throughout the course both to learn the statistical concepts discussed in the course and to analyze real data and come to informed conclusions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># git is a version control system (like &quot;Track Changes&quot; features from Microsoft Word but more powerful) and GitHub is the home for your Git-based projects on the internet (like DropBox but much better).</span></code></pre></div>
<p>An additional goal is to introduce you to git and GitHub, which is the collaboration and version control system that we will be using throughout the course.</p>
<p>As the labs progress, you are encouraged to explore beyond what the labs dictate; a willingness to experiment will make you a much better programmer and statistician. If you’re new to R, you should begin by building some basic fluency in R. Today’s lab will focus on fundamental building blocks of R and RStudio: the interface, reading in data, and basic commands. Starting next week, the labs will focus on concepts more specific to regression analysis.</p>
<p>To make versioning simpler, today’s lab is individual. This will give you a chance to become more familiar with git and GitHub. Next week you’ll learn about collaborating on GitHub and will produce a single lab report as a team.</p>
<div id="topics-covered-in-this-lab" class="section level3">
<h3><span class="header-section-number">10.1.1</span> Topics covered in this lab:</h3>
<ul>
<li>Exploratory Data Analysis (data visualizations and numerical summaries)</li>
<li>Simple linear regression</li>
<li>Writing a lab report using R Markdown</li>
<li>Tracking changes and submitting work using git and GitHub</li>
</ul>
</div>
</div>
<div id="packages-1" class="section level2">
<h2><span class="header-section-number">10.2</span> Packages</h2>
<p>We will use the following packages in today’s lab.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(readr)
<span class="kw">library</span>(skimr)
<span class="kw">library</span>(broom)</code></pre></div>
<p>If you need to install any of the packages, you can run the code below in the <strong>console</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>) 
<span class="kw">install.packages</span>(<span class="st">&quot;readr&quot;</span>)
<span class="kw">install.packages</span>(<span class="st">&quot;skimr&quot;</span>)
<span class="kw">install.packages</span>(<span class="st">&quot;broom&quot;</span>)</code></pre></div>
</div>
<div id="warm-up" class="section level2">
<h2><span class="header-section-number">10.3</span> Warm up</h2>
<p>Before we introduce the data, let’s warm up with some simple exercises.</p>
</div>
<div id="project-name" class="section level2">
<h2><span class="header-section-number">10.4</span> Project name:</h2>
<p>Currently your project is called <em>Untitled Project</em>. Update the name of your project to be “Lab 01 - Intro R”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The top portion of your R Markdown file (between the three dashed lines) is called YAML. It stands for &quot;YAML Ain&#39;t Markup Language&quot;. It is a human friendly data serialization standard for all programming languages. All you need to know is that this area is called the YAML (we will refer to it as such) and that it contains meta information about your document.</span></code></pre></div>
<div id="yaml" class="section level3">
<h3><span class="header-section-number">10.4.1</span> YAML:</h3>
<p>Open the R Markdown (Rmd) file in your project, change the author name to your name, and knit the document.</p>
</div>
<div id="commiting-changes" class="section level3">
<h3><span class="header-section-number">10.4.2</span> Commiting changes:</h3>
<p>Then go to the Git pane in your RStudio.</p>
<p>If you have made changes to your Rmd file, you should see it listed here. Click on it to select it in this list and then click on <strong>Diff</strong>. This shows you the <em>diff</em>erence between the last committed state of the document and its current state that includes your changes. If you’re happy with these changes, write “Update author name” in the <strong>Commit message</strong> box and click <strong>Commit</strong>.</p>
<p>You don’t have to commit after every change, this would get quite cumbersome. You should consider committing states that are <em>meaningful to you</em> for inspection, comparison, or restoration. In the first few assignments we will tell you exactly when to commit and in some cases, what commit message to use. As the semester progresses we will let you make these decisions.</p>
</div>
<div id="pushing-changes" class="section level3">
<h3><span class="header-section-number">10.4.3</span> Pushing changes:</h3>
<p>Now that you have made an update and committed this change, it’s time to push these changes to the web! Or more specifically, to your repo on GitHub. Why? So that others can see your changes. And by others, we mean the course teaching team (your repos in this course are private to you and us, only).</p>
<p>In order to push your changes to GitHub, click on <strong>Push</strong>. This will prompt a dialogue box where you first need to enter your user name, and then your password. This might feel cumbersome. Bear with me… We <em>will</em> teach you how to save your password so you don’t have to enter it every time. But for this one assignment you’ll have to manually enter each time you push in order to gain some experience with it.</p>
</div>
<div id="data-1" class="section level3">
<h3><span class="header-section-number">10.4.4</span> Data</h3>
<p>Today’s data comes from the Capital Bikeshare in Washington D.C. The Capital Bikeshare is a system in which customers can rent a bike for little cost, ride it around the city, and return it to a station near their destination. You can get more information about the bikeshare on their website, <a href="https://www.capitalbikeshare.com/" class="uri">https://www.capitalbikeshare.com/</a>. We will read in the data from the file <em>bikeshare.csv</em> located in the <em>data</em> folder.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bikeshare &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/bikeshare.csv&quot;</span>)</code></pre></div>
<p>This dataset contains information about the number of bike rentals, environmental conditions, and other information about the each day in 2011 and 2012.</p>
</div>
</div>
<div id="exercises-1" class="section level2">
<h2><span class="header-section-number">10.5</span> Exercises</h2>
<p>Before doing any analysis, we want to understand the basic structure of the data. One way to do this, is to look at the actual dataset. Type the code below in the <strong>console</strong> to view the entire dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">View</span>(bikeshare)</code></pre></div>
<p>It is sometimes more useful to view a summary of the data structure rather than view the entire dataset. This is especially true for very large datasets, i.e. those with a very large number of observations and/or rows. We can use the <code>glimpse()</code> function to get a general idea about the structure of our dataset. This function can be very useful when importing data from a file such as a .csv file (like in this lab) to ensure that data imported correctly and that we have the number of observations (rows) and variables (columns) we expect. We can also use this function to see each variable’s type (e.g. integer, character).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># You can  type `??glimpse` in the console to learn more about the function and its syntax.</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Type <code>glimpse(bikeshare)</code> in the <strong>console</strong> an overview of the <code>bikeshare</code> dataset.</li>
</ol>
<p>How many observations are in the <code>bikeshare</code> dataset? How many variables?</p>
<ol start="2" style="list-style-type: decimal">
<li>In this lab, we will focus the analysis on the following variables:</li>
</ol>
<table>
<tbody>
<tr class="odd">
<td><code>season</code></td>
<td>1: Winter, 2: Spring, 3: Summer, 4: Fall</td>
</tr>
<tr class="even">
<td><code>temp</code></td>
<td>Temperature (in <span class="math inline">\(^{\circ}C\)</span>) ÷ 41</td>
</tr>
<tr class="odd">
<td><code>count</code></td>
<td>total number of bike rentals</td>
</tr>
</tbody>
</table>
<p>Before fitting any regression models, we want to do an exploratory data analysis (EDA) to summarize the main characteristics of the data. Much of the EDA is visual, which we’ll get to in the next exercise. The EDA also consists of calculating summary statistics for the variables in our dataset. It is good practice to examine any variable that may be relevant to the analysis in the EDA, since there may be variables that aren’t directly included in the regression model but are still affecting the results. To keep today’s lab manageable, we will only examine the three variables <code>season</code>, <code>temp</code>, and <code>count</code>.</p>
<p>There are many ways to calculate summary statistics for each variable, and we will use a few of them throughout the semester. For now, let’s use the <code>skim()</code> function to calculate basic measures of center and spread along with get a sketch of the distribution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bikeshare <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(season,temp,count) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">skim</span>()</code></pre></div>
<p>What is the mean number of bike rentals? About 25% of the days in the data have a <code>count</code> above what value?</p>
<ol start="3" style="list-style-type: decimal">
<li>Does it make sense to calculate measures of center and spread for the variable <code>season</code>? If so, explain why it makes sense. Otherwise, explain why the <code>skim()</code> function calculated these summary statistics for the variable <code>season</code> even if they don’t make sense.</li>
</ol>
<p><em>This is a good place to pause and commit changes with the commit message “Added summary statistics (Ex 1 - 3)”, and push.</em></p>
<div id="visualizing-your-data" class="section level3">
<h3><span class="header-section-number">10.5.1</span> Visualizing Your Data</h3>
<ol start="4" style="list-style-type: decimal">
<li>One important part of EDA is visualizing the data to get a better idea of the shape of the distribution of each variable along with the relationship between variables. There are a lot of ways to make plots in R; we will use the functions available in the <code>ggplot2</code> package.</li>
</ol>
<p>The code below is used to create a histogram to visualize the distribution of <code>count</code>. Modify the code by writing an informative title and label for the x-axis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data=</span>bikeshare, <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>count)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_histogram</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;______&quot;</span>, <span class="dt">x=</span><span class="st">&quot;______&quot;</span>)</code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Sometimes you may want to customize a plot by changing different features such as the color, marker types, etc. When plotting a histogram, one easy way to customize it is by changing the color the bars. We’ll look at two different ways to do this.</li>
</ol>
<p>First, using a color of your choice, include the option <code>color=&quot;_____&quot;</code> inside of <code>geom_histogram()</code> function. Your code will look similar this. Be sure to also include an informative title and label for the x-axis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data=</span>bikeshare, <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>count)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">color=</span><span class="st">&quot;_______&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;______&quot;</span>, <span class="dt">x=</span><span class="st">&quot;______&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># This [ggplot2 quick reference](http://sape.inf.usi.ch/quick-reference/ggplot2/colour) has a long list of color options. You can also use [HTML color codes](https://htmlcolorcodes.com/).</span></code></pre></div>
<p>Next, instead of <code>color=&quot;_____&quot;</code>, use <code>fill=&quot;______&quot;</code> inside of the <code>geom_histogram()</code> function and put the color of your choice inside the blank. You can use the same color as before or use a new one.</p>
<p>What is the difference in the two plots? In other words, what is the difference in the way color is implemented when using <code>color</code> versus <code>fill</code>?</p>
<ol start="6" style="list-style-type: decimal">
<li>Describe the distribution of <code>count</code>. Your description should include comments about the shape, center, spread, and any potential outliers. You should use the histogram and the summary statistics from Exercise 2 in your description.</li>
</ol>
<p><em>This is a another good place to pause and commit changes with the commit message “Added data visualization of count (Ex 3 - 6)”, and push.</em></p>
<ol start="7" style="list-style-type: decimal">
<li>Now that we’ve examined the variables individually, we want to look at the relationship between the variables. To make interpretation easier, we will use the <code>mutate()</code> function to create a new variable called <code>temp_c</code> that is calculated as <code>temp * 41</code>. We will use <code>temp_c</code> for the remainder of the analysis, so the temperature can be discussed in terms of degrees Celsius.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bikeshare &lt;-<span class="st"> </span>bikeshare <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">temp_c =</span> temp <span class="op">*</span><span class="st"> </span><span class="dv">41</span>)</code></pre></div>
<p>Complete the code below to make a scatterplot of the number of bike rentals versus the temperature.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data=</span>bikeshare, <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>temp_c,<span class="dt">y=</span>count)) <span class="op">+</span>
<span class="st">  </span>___________________</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># [https://ggplot2.tidyverse.org/](https://ggplot2.tidyverse.org/) is a great resource as you learn `ggplot()`. Click **Reference** in the top right corner to see a list of the various plot types available in the ggplot2 package.</span></code></pre></div>
<p>Describe the relationship between the temperature and the number of bike rentals.</p>
<ol start="8" style="list-style-type: decimal">
<li>The temperature and number of bike rentals varies greatly depending on the season. Therefore, we would like to create a separate scatterplot of <code>count</code> versus <code>temp_c</code> for each season. To do so, we will use the <code>facet_wrap()</code> function, faceting by <code>season</code>. Recall from Exercise 2 that <code>season</code> is currently stored as an integer. We need to change it to a factor variable type before using it in the <code>facet_wrap()</code> function (you could also change it to a character variable).</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bikeshare &lt;-<span class="st"> </span>bikeshare <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">season =</span> <span class="kw">as.factor</span>(season))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data=</span>bikeshare, <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>temp_c,<span class="dt">y=</span>count)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Number of Bike Rentals vs. Temperature&quot;</span>, 
       <span class="dt">subtitle=</span><span class="st">&quot;Faceted by Season&quot;</span>, 
       <span class="dt">x =</span> <span class="st">&quot;Temperature (Celsius)&quot;</span>, 
       <span class="dt">y =</span> <span class="st">&quot;Number of Bike Rentals&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>season)</code></pre></div>
<p>For which season does the linear relationship between the temperature and the number of bike rentals appear to be the strongest?</p>
<p><em>This is a another good place to pause and commit changes with the commit message “Added visualization of count vs. temperature (Ex 7 - 8)”, and push.</em></p>
</div>
</div>
<div id="simple-linear-regression-1" class="section level2">
<h2><span class="header-section-number">10.6</span> Simple Linear Regression</h2>
<p>We want to fit a least-squares regression using the temperature (<code>temp_c</code>) to explain variation in the number of bike rentals (<code>count</code>) in the <strong>winter</strong> season. We can use the <code>filter()</code> function to create a subset from the data that only includes days during the winter. The <code>&lt;-</code> assigns the name <code>winter_data</code> to our subset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">winter_data &lt;-<span class="st"> </span>bikeshare <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(season<span class="op">==</span><span class="st">&quot;1&quot;</span>)</code></pre></div>
<p>We will use <code>winter_data</code> for the remainder of the lab.</p>
<ol start="9" style="list-style-type: decimal">
<li>Fit a simple linear regression model with using the <code>lm()</code> function; assign it the name <code>winter_model</code>. Replace <em>X</em>, <em>Y</em>, and <em>my.data</em> in the code below with the appropriate values.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">winter_model &lt;-<span class="st"> </span><span class="kw">lm</span>(Y <span class="op">~</span><span class="st"> </span>X, <span class="dt">data=</span>my.data)
<span class="kw">tidy</span>(model) <span class="co">#output model</span></code></pre></div>
<p>Interpret the slope.</p>
<p>Does it make sense to interpret the intercept? If so, write the interpretation of the intercept. Otherwise, explain why not.</p>
<ol start="10" style="list-style-type: decimal">
<li>We conclude by checking the assumptions for regression. We use the <code>mutate()</code> function to add a new variable called <code>resid</code> that is the residual for each observation in <code>winter_data</code> data.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">winter_data &lt;-<span class="st"> </span>winter_data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">resid =</span> <span class="kw">residuals</span>(winter_model))</code></pre></div>
<p>The code for the residuals vs. the predictor variable and the Normal QQ plot are below. In addition to these plots, write the code to make a histogram of the residuals. You can reuse code from a previous exercise to plot the histogram.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data=</span>winter_data, <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>temp_c,<span class="dt">y=</span>resid)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept=</span><span class="dv">0</span>,<span class="dt">color=</span><span class="st">&quot;red&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Residuals vs. Temperature&quot;</span>,
       <span class="dt">x=</span><span class="st">&quot;Temperature&quot;</span>, 
       <span class="dt">y=</span><span class="st">&quot;Residuals&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data=</span>winter_data, <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">sample=</span>resid)) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_qq</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">stat_qq_line</span>()<span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;Normal QQ Plot of Residuals&quot;</span>)</code></pre></div>
<p>Based on the plots of the residuals and the scatterplot, are linearity, normality, and constant variance assumptions met? Briefly explain.</p>
<p>Is the independence assumption met based on the description of the data? Briefly explain.</p>
<p><strong>Optional:</strong> Create a plot that could be used to help you assess the independence assumption.</p>
<p>Throughout the semester, we will learn various methods to deal with any violations in regression assumptions. For now, we will just note them.</p>
<p><em>You’re done! Commit all remaining changes, use the commit message “Done with Lab 1!”, and push. Before you wrap up the assignment, make sure all documents are updated on your GitHub repo.</em></p>

</div>
<div id="computing-college-admissions-1" class="section level2">
<h2><span class="header-section-number">10.7</span> Computing: College Admissions</h2>
<p>The primary goal of today’s lab is to give you practice with some of the tools you will need to conduct regression analysis using R. An additional goal for today is for you to be introduced to your teams and practice collaborating using GitHub and RStudio.</p>
<div id="packages-2" class="section level3">
<h3><span class="header-section-number">10.7.1</span> Packages</h3>
<p>We will use the following packages in today’s lab.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(skimr)
<span class="kw">library</span>(broom)
<span class="kw">library</span>(rcfss)</code></pre></div>
</div>
<div id="data-2" class="section level3">
<h3><span class="header-section-number">10.7.2</span> Data</h3>
<p>In today’s lab, we will analyze the <code>scorecard</code> dataset from the rcfss package. This dataset contains information about 1849 colleges obtained from the Department of Education’s College Scorecard. Load the rcfss library into the global R environment and type <code>?scorecard</code> in the <strong>console</strong> to learn more about the dataset and variable definitions. Today’s analysis will focus on the following variables:</p>
<table style="width:76%;">
<colgroup>
<col width="16%" />
<col width="59%" />
</colgroup>
<tbody>
<tr class="odd">
<td><code>type</code></td>
<td>Type of college (Public, Private - nonprofit, Private - for profit)</td>
</tr>
<tr class="even">
<td><code>cost</code></td>
<td>The average annual cost of attendance, including tuition and feeds, books and supplies, and living expenses, minus the average grant/scholarship aid</td>
</tr>
<tr class="odd">
<td><code>admrate</code></td>
<td>Undergraduate admissions rate (from 0 - 100%)</td>
</tr>
</tbody>
</table>
</div>
<div id="exercises-2" class="section level3">
<h3><span class="header-section-number">10.7.3</span> Exercises</h3>
<div id="exploratory-data-analysis-1" class="section level4">
<h4><span class="header-section-number">10.7.3.1</span> Exploratory Data Analysis</h4>
<ol style="list-style-type: decimal">
<li><p>Plot a histogram to examine the distribution of <code>admrate</code>. What is the shape of the distribution?</p></li>
<li><p>To better understand the distribution of <code>admrate</code>, we would like calculate measures of center and spread of the distribution. Fill in the code below to use the <code>skim</code> function to calculate summary statistics for <code>admrate</code>. Report the appropriate measures of center (mean or median) and spread (standard deviation or IQR) based on the shape of the distribution from Exercise 1.</p></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scorecard <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(admrate) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">skim</span>()</code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><p>Plot the distribution of <code>cost</code> and calculate the appropriate summary statistics. Describe the distribution of <code>cost</code> (shape, center, and spread) using the plot and appropriate summary statistics.</p></li>
<li><p>One nice feature of the <code>skim</code> function is that it provides information about the number of observations that are missing values of the variable. How many observations have missing values of <code>admrate</code>? How many observations have missing values of <code>cost</code>?</p></li>
<li><p>Later in the semester, we will techniques to deal with missing values in the data. For now, however, we will only include complete observations for the remainder of this analysis. We can use the <code>filter</code> function to select only the rows that values for both <code>cost</code> and <code>admrate</code>.</p></li>
</ol>
<p>Fill in the code below to create a new dataset called <code>scorecard_new</code> that only includes observations with values for both <code>admrate</code> and <code>cost</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">__________ &lt;-<span class="st"> </span>scorecard <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(admrate),________)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Learn more about the `filter` function in [Section 5.2 of R for Data Science] (https://r4ds.had.co.nz/transform.html#filter-rows-with-filter)</span></code></pre></div>
<p>You will use <code>scorecard_new</code> for the rest of the lab.</p>
<ol start="6" style="list-style-type: decimal">
<li><p>Create a scatterplot to display the relationship between <code>cost</code> (response variable) and <code>admrate</code> (explanatory variable). Use the scatterplot to describe the relationship between the two variables.</p></li>
<li><p>The data contains information about the type of college, and we would like to incorporate this information into the scatterplot. One way to do this is to use a different color marker for each type of college. Fill in the code below the scatterplot from the previous exercise with the marker colors based on the variable <code>type</code>. Describe two new observations from this scatterplot that you didn’t see in the previous plot.</p></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data=</span>scorecard_new, <span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>admrate, <span class="dt">y=</span>cost, <span class="dt">color=</span>type)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span>_____________________</code></pre></div>
</div>
<div id="simple-linear-regression-2" class="section level4">
<h4><span class="header-section-number">10.7.3.2</span> Simple Linear Regression</h4>
<ol start="8" style="list-style-type: decimal">
<li><p>Fit a regression model to describe the relationship between a college’s admission rate and cost. Use the <code>tidy</code> function to display the model.</p></li>
<li><p>Interpret the slope in the context of the problem. Does the intercept have a meaningful interpretation? If so, write the interpretation in the context of the problem. Otherwise, explain why the interpretation is not meaningful.</p></li>
<li><p>While the <code>tidy</code> function is used to display the model, we can obtain a one-row summary of the model using the <code>glance</code> function. Use the <code>glance</code> function to get a summary of the model fit in the previous exercise. See the <a href="https://rdrr.io/cran/broom/man/glance.lm.html">documentation for <code>glance</code></a> for the syntax and a list of values output from the function.</p></li>
<li><p>What is the value of <span class="math inline">\(R^2\)</span>? Interpret this value in the context of the problem. Do you think this is a “good” value of <span class="math inline">\(R^2\)</span>? Explain.</p></li>
<li><p>What is the value of <span class="math inline">\(\hat{\sigma}\)</span>, the residual standard error.</p></li>
<li><p>What is the 95% confidence interval for the coefficient of <code>admrate</code>, i.e. the slope? Interpret the interval in the context of the data.</p></li>
<li><p>We want to test the following hypotheses about the population slope <span class="math inline">\(\beta_1\)</span>:</p></li>
</ol>
<p><span class="math display">\[H_0: \beta_1 = 0 \hspace{5mm} \text{versus} \hspace{5mm} H_a: \beta_1 \neq 0\]</span></p>
<p>State what the null and alternative hypotheses mean in terms of the linear relationship between <code>admrate</code> and <code>cost</code>.</p>
<ol start="15" style="list-style-type: decimal">
<li>Consider the confidence interval from Exercise 13 and the hypotheses in Exercise 14. Is the confidence interval consistent with the null or alternative hypothesis? Briefly explain.</li>
</ol>

</div>
</div>
</div>
<div id="anova" class="section level2">
<h2><span class="header-section-number">10.8</span> ANOVA</h2>
<p>The goal of this lab is to use Analysis of Variance (ANOVA) to compare means in multiple groups. Additionally, you will be introduced to new R functions used for <a href="https://en.wikipedia.org/wiki/Data_wrangling">wrangling</a> and summarizing data.</p>
<div id="packages-3" class="section level3">
<h3><span class="header-section-number">10.8.1</span> Packages</h3>
<p>We will use the following packages in today’s lab.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(knitr)
<span class="kw">library</span>(broom)</code></pre></div>
</div>
<div id="data-3" class="section level3">
<h3><span class="header-section-number">10.8.2</span> Data</h3>
<p>In today’s lab, we will analyze the <code>diamonds</code> dataset from the ggplot2 package. Type <code>?diamonds</code> in the console to see a dictionary of the variables in the data set. This analysis will focus on the relationship between a diamond’s carat weight and its color. Before starting the exercises, take a moment to read more about the diamond attributes on the Gemological Institute of America webpage: <a href="https://www.gia.edu/diamond-quality-factor" class="uri">https://www.gia.edu/diamond-quality-factor</a>.</p>
</div>
</div>
<div id="exercises-3" class="section level2">
<h2><span class="header-section-number">10.9</span> Exercises</h2>
<p>The diamonds dataset contains the price and other characteristics for over 50,000 diamonds price from $326 to $18823. In this lab, we will analyze the subset of diamonds that are priced $1200 or less.</p>
<ol style="list-style-type: decimal">
<li>Create a dataframe called <code>diamonds_low</code> that is the subset of diamonds priced $1200 or less. How many observations are in <code>diamonds_low</code>?</li>
</ol>
<p>When using Analysis of Variance (ANOVA) to compare group means, it is ideal to have approximately the same number of observations in each group. Therefore, we will combine the worst two color groups, I and J, and create a new color category called “I/J”. Since <code>color</code> is an ordinal (<code>&lt;ord&gt;</code>) variable, we need to use the <code>recode_factor</code> function in the dplyr package to create the new category.</p>
<p>Use the <code>count</code> function before and after making the new color category to ensure the recoding worked as expected.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## number of observations at each color level 
diamonds_low <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>(color)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#create a new vector of the recoded values</span>
color_recoded &lt;-<span class="st">  </span><span class="kw">recode_factor</span>(diamonds_low<span class="op">$</span>color,
                                <span class="st">`</span><span class="dt">I</span><span class="st">`</span> =<span class="st"> &quot;I/J&quot;</span>, <span class="st">`</span><span class="dt">J</span><span class="st">`</span> =<span class="st"> &quot;I/J&quot;</span>,
                                <span class="dt">.default =</span> <span class="kw">levels</span>(diamonds_low<span class="op">$</span>color))

<span class="co">#replace the color variable with the recoded data</span>
diamonds_low &lt;-<span class="st"> </span>diamonds_low <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">color =</span> color_recoded)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Refer to the [ggplot2 Cheat Sheet](https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf) and [ggplot2 reference](https://ggplot2.tidyverse.org/reference/index.html) for plot ideas and help with code.</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><p>We begin by plotting the relationship between <code>color</code> and <code>carat</code>. As a group, brainstorm ways to plot the relationship between the two variables, then make one of the plots. Be sure to include informative axes labels and an informative title.</p></li>
<li><p>Fill in the code below to calculate the mean and variance of <code>carat</code> at each level of <code>color</code>.</p></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The `group_by` function is used to do calculation in groups. The `summarise` function is used to reduce variables to values.</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds_low <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(_______) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>(), 
            <span class="dt">avg_carat =</span> <span class="kw">mean</span>(carat),
            <span class="dt">var_carat =</span> _______)</code></pre></div>
<p>Based on the plots and summary statistics, does there appear to be a relationship between carat weight the color of diamonds? In other words, does there appear to be a significant difference in the mean carat weight across colors?</p>
<ol start="4" style="list-style-type: decimal">
<li>When using ANOVA to compare means across groups, we make the following assumptions (note how similar they are to the assumptions for regression):</li>
</ol>
<ul>
<li><strong>Normality</strong>: The distribution of <span class="math inline">\(y\)</span> is approximately normal within each category of <span class="math inline">\(x\)</span> - in the <span class="math inline">\(k^{th}\)</span> category, <span class="math inline">\(y \sim (\mu_k, \sigma^2)\)</span> . If the sample size is large, ANOVA is robust to some departures from Normality.</li>
<li><strong>Independence</strong>: All observations are independent from one another, i.e. one observation does not affect another.</li>
<li><strong>Constant Variance</strong>: The distribution of <span class="math inline">\(y\)</span> within each category of <span class="math inline">\(x\)</span> has a common variance, <span class="math inline">\(\sigma^2\)</span>. One way to assess if variances are sufficiently equal is to look at the ratio of the maximum group variance to the minimum group variance. If this ratio is less than 2, then we can conclude the variances are approximately equal. This isn’t an exact threshold, but rather a commonly used guideline. <em>Note: There are formal tests for equal variance that are outside the scope of this class.</em></li>
</ul>
<p>Are the assumptions for ANOVA met? Comment on each assumption using the summary statistics and/or plots from previous exercises to support your conclusion. You may also calculate any additional summary statistics or make additional plots as needed.</p>
<p><em>Regardless of your answer to Excerise 4, We will proceed with the analysis in the remainder of this lab as if the assumptions are met.</em></p>
<ol start="5" style="list-style-type: decimal">
<li>Use the code below to calculate the ANOVA table. The <code>tidy</code> function from the broom package is used to put the ANOVA output in a dataframe, and with the <code>kable</code> function from the knitr package, you can display the results in an easy-to-read table.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">anova &lt;-<span class="st"> </span><span class="kw">aov</span>(carat <span class="op">~</span><span class="st"> </span>color, <span class="dt">data=</span>diamonds_low)
anova <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tidy</span>() <span class="op">%&gt;%</span>
<span class="st">   </span><span class="kw">kable</span>()</code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li><p>Use the ANOVA table to calculate the total mean square, i.e. the sample variance of <code>carat</code>. Show your calculations. You can put the calculations in a code chunk to use R like a calculator.</p></li>
<li><p>What is <span class="math inline">\(\hat{\sigma}^2\)</span>, the estimated variance of <code>carat</code> within each level of <code>color</code>.</p></li>
<li><p>We can use ANOVA to test if the true mean value of <code>carat</code> is equal for all levels of <code>color</code>, i.e.</p></li>
</ol>
<p><span class="math display">\[ H_0: \mu_1 = \mu_2 = \dots = \mu_6\]</span></p>
<p>State the alternative hypothesis is the context of the data.</p>
<ol start="9" style="list-style-type: decimal">
<li><p>Based on the ANOVA table, what is your conclusion from the test of the hypotheses in the previous question? State the conclusion in the context of the data.</p></li>
<li><p>Use the code below to plot a 95% confidence interval for the mean carat weight at each level of color. Calculate the value of <code>sigma</code> by filling in the estimated variance from Exercise 7.</p></li>
</ol>
<p>The formula for the confidence interval for the mean of group <span class="math inline">\(k\)</span> is</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The critical value $t^*$ is calculated using the *t* distribution with $n-K$ degrees of freedom. </span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The standard error of the mean is calculated using $\hat{\sigma}$, the square root of the variance within each group calculated from the ANOVA table.</span></code></pre></div>
<p><span class="math display">\[\bar{y}_k \pm t^* \frac{\hat{\sigma}}{\sqrt{n_k}}\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n.groups &lt;-<span class="st"> </span>diamonds_low <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>(color) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>()
crit.val &lt;-<span class="st"> </span><span class="kw">qt</span>(<span class="fl">0.975</span>, (<span class="kw">nrow</span>(diamonds_low)<span class="op">-</span>n.groups<span class="op">$</span>n))
sigma &lt;-<span class="st"> </span><span class="kw">sqrt</span>(_________)

conf.intervals &lt;-<span class="st"> </span>diamonds_low <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(color) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_carat =</span> <span class="kw">mean</span>(carat), <span class="dt">n =</span> <span class="kw">n</span>(), 
            <span class="dt">lower =</span> mean_carat <span class="op">-</span><span class="st"> </span>crit.val <span class="op">*</span><span class="st"> </span>sigma<span class="op">/</span><span class="kw">sqrt</span>(n),
            <span class="dt">upper =</span> mean_carat <span class="op">+</span><span class="st"> </span>crit.val <span class="op">*</span><span class="st"> </span>sigma<span class="op">/</span><span class="kw">sqrt</span>(n))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data=</span>conf.intervals,<span class="kw">aes</span>(<span class="dt">x=</span>color,<span class="dt">y=</span>mean_carat)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lower, <span class="dt">ymax =</span> upper), <span class="dt">width =</span> <span class="fl">0.1</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;95% confidence interval for the mean value of carat&quot;</span>,
       <span class="dt">subtitle=</span><span class="st">&quot;by Color&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre></div>
<ol start="11" style="list-style-type: decimal">
<li><p>For what color level is the mean carat weight the most different from all the others?</p></li>
<li><p>Based on this analysis, describe the relationship between the color and the mean carat weight in diamonds that cost $1200 or less. <em>Refer to the diamond documentation to recall what the color scale means.</em></p></li>
</ol>
<p><em>You’re done! Commit all remaining changes, use the commit message “Done with Lab 3!”, and push. Before you wrap up the assignment, make sure the .Rmd, .html, and .md documents are all updated on your GitHub repo.</em></p>

</div>
<div id="multiple-linear-regression" class="section level2">
<h2><span class="header-section-number">10.10</span> Multiple Linear Regression</h2>
<p>
<p><span class="marginnote shownote"> <!--
<div class="figure">--> <img src="img/04-mlr/seattle-home.jpg" alt=" " width="527"  /> <br><br> <img src="img/04-mlr/seattle-home-3.jpg" alt=" " width="527"  /></p>
<!--
<p class="caption marginnote">-->
<!--</p>-->
<!--</div>-->
</span>
</p>
<p>The goal of this lab is to use multiple linear regression to understand the variation in the selling price of houses in King County, Washington. You will also gain practice using special predictors, such as categorical predictors and interaction effects, in the model, and you will be introduced to variable transformations.</p>
<div id="packages-4" class="section level3">
<h3><span class="header-section-number">10.10.1</span> Packages</h3>
<p>We will use the following packages in today’s lab.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(knitr)
<span class="kw">library</span>(broom)</code></pre></div>
</div>
<div id="data-4" class="section level3">
<h3><span class="header-section-number">10.10.2</span> Data</h3>
<p>The for today’s lab contains the price and other characteristics of over 20,000 houses sold in King County, Washington (the county that includes Seattle). The dataset includes the following variables:</p>
<ul>
<li><code>price</code>: selling price of the house</li>
<li><code>date</code>: date house was sold, measured in days since January 1, 2014</li>
<li><code>bedrooms</code>: number of bedrooms</li>
<li><code>bathrooms</code>: number of bathrooms</li>
<li><code>sqft</code>: interior square footage</li>
<li><code>floors</code>: number of floors</li>
<li><code>waterfront</code>: 1 if the house has a view of the waterfront, 0 otherwise</li>
<li><code>yr_built</code>: year the house was built</li>
<li><code>yr_renovated</code>: 0 if the house was never renovated, the year the house was renovated if else</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">houses &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/KingCountyHouses.csv&quot;</span>)</code></pre></div>
</div>
</div>
<div id="exercises-4" class="section level2">
<h2><span class="header-section-number">10.11</span> Exercises</h2>
<ol style="list-style-type: decimal">
<li>Use data visualization and summary statistics to examine the distribution of <code>bedrooms</code>. What is the maximum value? Does this value make sense? If not, what is this an indication of, i.e. how did this value get recorded in the data? Briefly explain.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># See the [documentation](https://dplyr.tidyverse.org/reference/summarise.html) for more information about the `summarise` function.</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><p>We want to remove observations that have extreme values for bedrooms, i.e. those with values for <code>bedrooms</code> above the 95<sup>th</sup> percentile in the data. What is the 95<sup>th</sup> percentile for <code>bedrooms</code>? Use the <code>summarise</code> function to help you calculate this value.</p></li>
<li><p>Fill in the code below to filter the data so that the extreme observations are removed. How many observations are in the updated dataset?</p></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">houses &lt;-<span class="st"> </span>houses <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(bedrooms <span class="op">&lt;=</span><span class="st"> </span>____)</code></pre></div>
<p>We will use this dataset for the remainder of the analysis.</p>
<ol start="4" style="list-style-type: decimal">
<li>Fit a regression model using square feet to explain variation in the price. Plot the residuals versus the predicted values. Based on this plot, what regression assumption appears to be violated? Briefly explain.</li>
</ol>
<p>Plot the histogram and Normal QQ-plot of the residuals. Based on these plots, what regression assumption appears to be violated? Briefly explain.</p>
<ol start="5" style="list-style-type: decimal">
<li>One way to deal with violations in regression assumptions is to transform the response variable and use that transformed variable when fitting the regression model. (We will talk about this in class next week). Some common transformations used in regression are the natural log (<code>log(y)</code>), the square root (<code>sqrt(y)</code>), and the reciprocal (<code>1/y</code>).</li>
</ol>
<p>Each transformation is applied to the response variable <code>price</code>, and the distributions of the transformed data are shown below.</p>
<p>Which transformation should we use to fix the violations of the model assumptions observed in the previous exercise? Briefly explain your choice.</p>
<ol start="6" style="list-style-type: decimal">
<li><p>Add the variable <code>logprice</code>, the log-transformed version of <code>price</code>, to the data frame. Fit a regression model with <code>logprice</code> as the response and <code>sqft</code> as the predictor variable. Create the residuals plots (residuals vs. predicted, histogram of residuals, Normal QQ-plot). Briefly comment on whether or not using the transformed variable improved on the model assumptions.</p></li>
<li><p>Though we can explain about 48% of the variation in a house prices by the square footage, we would like to incorporate some of the other available house characteristics in the model.</p></li>
</ol>
<p>Before fitting the model, use the code below to add the variable<code>floorsCat</code> that is the categorical version of the variable <code>floors</code>. Discuss with your group why it may make sense to treat <code>floors</code> as categorical, even though it represents a count.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">houses &lt;-<span class="st"> </span>houses <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">floorsCat =</span> <span class="kw">as.factor</span>(floors))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># See the [documentation](https://dplyr.tidyverse.org/reference/tally.html) for more information about the `count` function.</span></code></pre></div>
<p>Use the <code>count</code> function to see the number of observations at each level of <code>floorsCat</code>. What is the most common number of floors?</p>
<ol start="8" style="list-style-type: decimal">
<li>Use the code below to calculate the mean-centered versions of the variables <code>sqft</code>, <code>bedrooms</code>, and <code>bathrooms</code> and add them to the data frame.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">houses &lt;-<span class="st"> </span>houses <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sqftCent =</span> sqft <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(sqft), 
         <span class="dt">bedroomsCent =</span> bedrooms <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(bedrooms),
         <span class="dt">bathroomsCent =</span> bathrooms<span class="op">-</span><span class="kw">mean</span>(bathrooms))</code></pre></div>
<p>It is not appropriate to calculate the mean-centered version of the variable <code>waterfront</code>. Briefly explain why it isn’t.</p>
<ol start="9" style="list-style-type: decimal">
<li><p>Fit a regression model with <code>logprice</code> as the response variable, and the mean-centered variables from the previous exercise along with <code>waterfront</code> and <code>floorsCat</code> as the predictor variables. Display the model output.</p></li>
<li><p>What is the baseline level for the variable <code>floorsCat</code>?</p></li>
<li><p>Interpret the intercept of the model in the context of the data. Write the interpretation in terms of the <strong>price</strong>.</p></li>
<li><p>What is the intercept of the model for the subset of houses with 3 floors that are not on the waterfront? Write the intercept in terms of the <strong>log(price)</strong>.</p></li>
<li><p>We would like to consider potential interactions for the model. A significant <strong>interaction</strong> occurs when the relationship of a predictor variable with the response depends on the value of another predictor variable.</p></li>
</ol>
<p>Fill in the code below to plot the relationship between <code>logprice</code> and <code>bedrooms</code> by <code>waterfront</code>. Based on this plot, do you think there is a significant interaction effect between <code>bedrooms</code> and <code>waterfront</code>? In other words, do you think the relationship between the logprice and the number of bedrooms differs based on whether or not a house is on the waterfront? Briefly explain.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data=</span>houses,<span class="dt">mapping=</span><span class="kw">aes</span>(<span class="dt">x=</span>_____,<span class="dt">y=</span>_____,<span class="dt">color=</span><span class="kw">as.factor</span>(waterfront))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>, <span class="dt">se=</span><span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title=</span><span class="st">&quot;__________________&quot;</span>, 
       <span class="dt">x=</span><span class="st">&quot;Number of bedrooms&quot;</span>, 
       <span class="dt">y=</span><span class="st">&quot;Log Price&quot;</span>,
       <span class="dt">color=</span><span class="st">&quot;Waterfront&quot;</span>)</code></pre></div>
<p><strong>We will talk more about interaction effects in Monday’s lecture. In HW 03, you explore potential interaction effects using this housing data.</strong></p>
<p><em>You’re done! Commit all remaining changes, use the commit message “Done with Lab 4!”, and push. Before you wrap up the assignment, make sure the .Rmd and .md documents are updated in your GitHub repo. There is a 10% penalty if the .Rmd file has to be knitted to display graphs, i.e. the graphs are not showing in the .md file on GitHub.</em></p>
<div id="acknowledgement" class="section level3">
<h3><span class="header-section-number">10.11.1</span> Acknowledgement</h3>
<p>The data used in this lab was obtained from <a href="https://github.com/proback/BYSH" class="uri">https://github.com/proback/BYSH</a>.</p>

</div>
</div>
<div id="data-wrangling-multiple-linear-regression" class="section level2">
<h2><span class="header-section-number">10.12</span> Data Wrangling &amp; Multiple Linear Regression</h2>
<p>When doing statistical analyses in practice, there is often a lot of time spent on cleaning and preparing the data. The goal of today’s lab is to practice cleaning messy data, so it can be used in a regression analysis. You will also practice interpreting the results from a regression model that has numeric and categorical predictors and a log-transformed response variable.</p>
<div id="packages-5" class="section level3">
<h3><span class="header-section-number">10.12.1</span> Packages</h3>
<p>We will use the following packages in today’s lab.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(knitr)
<span class="kw">library</span>(skimr)
<span class="kw">library</span>(broom)</code></pre></div>
</div>
<div id="data-5" class="section level3">
<h3><span class="header-section-number">10.12.2</span> Data</h3>
<p>Today’s data is about Airbnb listings in Asheville, NC. The data was obtained from <a href="http://insideairbnb.com/index.html">http://insideairbnb.com/</a>; it was originally scraped from <a href="https://www.airbnb.com/">airbnb.com</a>.</p>
<p>You can see a visualization of some of the data used in today’s lab at <a href="http://insideairbnb.com/asheville/" class="uri">http://insideairbnb.com/asheville/</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">basic_info &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/airbnb_basic.csv&quot;</span>)
details &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/airbnb_details.csv&quot;</span>)</code></pre></div>
<p>We will use the following variables in this lab:</p>
<ul>
<li><code>price</code>: Cost per night (in U.S. dollars)</li>
<li><code>cleaning_fee</code>: Cleaning fee (in U.S. dollars)</li>
<li><code>property_type</code>: Type of dwelling (House, Apartment, etc.)</li>
<li><code>room_type</code>:
<ul>
<li><em>Entire home/apt</em> (guests have entire place to themselves)</li>
<li><em>Private room</em> (Guests have private room to sleep, all other rooms shared)</li>
<li><em>Shared room</em> (Guests sleep in room shared with others)</li>
</ul></li>
<li><code>number_of_reviews</code>: Total number of reviews for the listing</li>
<li><code>review_scores_rating</code>: Average review score (0 - 100)</li>
</ul>
</div>
</div>
<div id="exercises-5" class="section level2">
<h2><span class="header-section-number">10.13</span> Exercises</h2>
<div id="data-wrangling" class="section level3">
<h3><span class="header-section-number">10.13.1</span> Data wrangling</h3>
<ol style="list-style-type: decimal">
<li>We would like to use variables from both the <code>basic_info</code> and <code>details</code> data frames in this analysis. Both dataframes have the variable <code>id</code> that uniquely identifies each Airbnb listing. Because we need data from <code>basic_info</code> and <code>details</code>, we only want to include observations that are in both the <code>basic_info</code> and <code>details</code> datasets. Therefore, we will use an <code>inner_join</code> to combine the two data sets. (Note: Both data frames include a variable called <code>id</code> that uniquely identifies each Airbnb listing. R will use this variable to join the two data frames.)</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># See [Section 13.4 of *R for Data Science*](https://r4ds.had.co.nz/relational-data.html#mutating-joins) for more information about joins.</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">airbnb &lt;-<span class="st"> </span><span class="kw">inner_join</span>(basic_info,details)</code></pre></div>
<p>How many observations are in <code>airbnb</code>? How many variables?</p>
<ol start="2" style="list-style-type: decimal">
<li>Some Airbnb rentals have cleaning fees, and we want to include the cleaning fee when we calculate the total rental cost. Use the code below to see how the data in the column <code>cleaning_fee</code> is currently stored in the <code>airbnb</code> data frame.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">typeof</span>(airbnb<span class="op">$</span>cleaning_fee)</code></pre></div>
<p>The column <code>cleaning_fee</code> currently contains what type of data? Why do you think the data is stored this way even though <code>cleaning_fee</code> is a quantitative variable?</p>
<ol start="3" style="list-style-type: decimal">
<li>Since <code>cleaning_fee</code> is a quantitative variable, we need to make sure it is stored as numeric data in the dataframe. To do so, we will first use the <code>extract</code> function in <code>tidyr</code> package to create a column of cleaning fees that don’t have the dollar sign. Then, we will use the <code>as.numeric()</code> function to make the extracted data the numeric data type <code>double</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># See [https://tidyr.tidyverse.org/reference/extract.html) for more information about the `extract` function.</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">airbnb &lt;-<span class="st"> </span>airbnb <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">extract</span>(cleaning_fee, <span class="st">&quot;cleaning_fee&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cleaning_fee =</span> <span class="kw">as.numeric</span>(cleaning_fee))</code></pre></div>
<p>Use the <code>typeof</code> function to confirm that <code>cleaning_fee</code> is now stored as a <code>double</code> data type.</p>
<ol start="4" style="list-style-type: decimal">
<li><p>Use the <code>skim</code> function to view a summary of the <code>cleaning_fee</code> data. How many observations have missing values for <code>cleaning_fee</code>? What do you think is the most likely reason for the missing observations of <code>cleaning_fee</code>? In other words, what does a missing value of <code>cleaning_fee</code> indicate?</p></li>
<li><p>Fill in the code below to impute the missing values of <code>cleaning_fee</code> with an appropriate numeric value. Then use the <code>skim</code> function to confirm that there are no longer missing values of <code>cleaning_fee</code>.</p></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># See [https://dplyr.tidyverse.org/reference/case_when.html](https://dplyr.tidyverse.org/reference/case_when.html) for more information about the `case_when` function.</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">airbnb &lt;-<span class="st"> </span>airbnb <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cleaning_fee =</span> <span class="kw">case_when</span>(
    <span class="kw">is.na</span>(cleaning_fee) <span class="op">~</span><span class="st"> </span>______, 
    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>cleaning_fee
  ))</code></pre></div>
<p><em>This is an example of data that is missing not at random, since there is a specific pattern/explanation to the misisng data. We will talk more about dealing with missing data later in the semester.</em></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># See [Section 5.6.3 of *R for Data Science*](https://r4ds.had.co.nz/transform.html#counts) for more information about counting observations.</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Next, we look at the variable <code>property_type</code>.
<ul>
<li>Use the <code>count</code> function to determine how many categories are in the variable <code>property</code> and the frequency of each category.</li>
<li>What are the top 4 most common property types? These make up what proportion of the observations?</li>
</ul></li>
<li>Since an overwhelming majority of the observations in the data are one of the top 4 property types, we would like to create a simplified version of the <code>proprety_type</code> variable that has 5 categories: <em>House</em>, <em>Apartment</em>, <em>Guest suite</em>, <em>Bungalow</em>, and <em>Other</em>. Fill in the code below to create <code>prop_type_simp</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">airbnb &lt;-<span class="st"> </span>airbnb <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop_type_simp =</span> <span class="kw">case_when</span>(
    property_type <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;House&quot;</span>,<span class="st">&quot;______&quot;</span>, <span class="st">&quot;______&quot;</span>,<span class="st">&quot;______&quot;</span>) <span class="op">~</span><span class="st"> </span>property_type, 
    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;Other&quot;</span>
  ))</code></pre></div>
<p>Use the code below to check that <code>prop_type_simp</code> was correctly made.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">airbnb <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(property_type, prop_type_simp) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n))</code></pre></div>
<ol start="8" style="list-style-type: decimal">
<li>Airbnb is most commonly used for travel purposes, i.e. as an alternative to traditional hotels. We only want to include Airbnb listings in our regression analysis that are intended for travel purposes. What are the 5 most common values for the variable <code>minimum_nights</code>? Which value in the top 5 stands out? What is the likely intended purpose for Airbnb listings with this seemingly unusual value for <code>minimum_nights</code>?</li>
</ol>
<p>Filter the <code>airbnb</code> data so that it only includes observations with <code>minimum_nights &lt;= 3</code>. You will use this filtered dataset for the remainder of the lab.</p>
</div>
<div id="regression-analysis" class="section level3">
<h3><span class="header-section-number">10.13.2</span> Regression Analysis</h3>
<ol start="9" style="list-style-type: decimal">
<li><p>For the response variable, will use the cost to stay at an Airbnb location for 3 nights. Create a new variable called <code>price_3_nights</code> that uses <code>price</code> and <code>cleaning_fee</code> to calculate the total cost to stay at the Airbnb property for 3 nights. Be sure to add this variable to your dataframe.</p></li>
<li><p>Use histograms to examine the distributions of <code>price_3_nights</code> and <code>log(price_3_nights)</code>. Based on the histograms, which variable should you use for the regression model? Briefly explain.</p></li>
</ol>
<p>Use this variable as the response for the remainder of the lab.</p>
<ol start="11" style="list-style-type: decimal">
<li><p>Fit a regression model called <code>model1</code> with the response variable from the previous question and the following predictor variables: <code>prop_type_simp</code>, <code>number_of_reviews</code>, and <code>review_scores_rating</code>. Display the model output.</p></li>
<li><p>Interpret the coefficient <code>review_scores_rating</code> in terms of <code>price_3_nights</code>.</p></li>
<li><p>Interpret the coefficient of <code>prop_type_simpGuest suite</code> in terms of <code>price_3_nights</code>.</p></li>
<li><p>We want to determine if <code>room_type</code> is a significant predictor of the cost for 3 nights, given everything else in the model. Fit a regression model called <code>model2</code> that includes all of the predictor variables in <code>model1</code> and <code>room_type</code>. Display the model output.</p></li>
</ol>
<p>Use the code below to conduct a Nested F test to determine if <code>room_type</code> is a significant predictor of the minimum cost. What is your conclusion from the Nested F test?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anova</span>(model1, model2)</code></pre></div>
<ol start="15" style="list-style-type: decimal">
<li>Suppose you are planning to visit Asheville over spring break, and you want to stay in an Airbnb. You find an Airbnb that is an apartment with a private room, has 10 reviews, and an average rating of 90. Use <code>model2</code> to predict the total cost to stay at this Airbnb for 3 nights. Include the appropriate 95% interval with your prediction. Report the prediction and interval in terms of <code>price_3_nights</code>.</li>
</ol>
<p><em>You’re done! Commit all remaining changes, use the commit message “Done with Lab 5!”, and push. Before you wrap up the assignment, make sure the .Rmd and .md documents are updated in your GitHub repo. There is a 10% penalty if the .Rmd file has to be knitted to display graphs, i.e. the graphs are not showing in the .md file on GitHub.</em></p>
</div>
<div id="acknowledgement-1" class="section level3">
<h3><span class="header-section-number">10.13.3</span> Acknowledgement</h3>
<p>The data from this lab is from <a href="http://insideairbnb.com/index.html">insideairbnb.com</a></p>

</div>
</div>
<div id="model-selection" class="section level2">
<h2><span class="header-section-number">10.14</span> Model Selection</h2>
<p>The goal of today’s lab is to practice forward and backward model selection. In addition to practice with model selection functions in R, you will manually conduct a backward selection procedure to better understand what occurs when you use model selection functions.</p>
<div id="packages-6" class="section level3">
<h3><span class="header-section-number">10.14.1</span> Packages</h3>
<p>You will need the following packages for today’s lab:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(knitr)
<span class="kw">library</span>(broom)
<span class="kw">library</span>(leaps)
<span class="kw">library</span>(Sleuth3) <span class="co">#case1201 data</span>
<span class="kw">library</span>(ISLR) <span class="co">#Hitters data</span></code></pre></div>
</div>
<div id="data-6" class="section level3">
<h3><span class="header-section-number">10.14.2</span> Data</h3>
<p>There are two datasets for this lab.</p>
<div id="part-i" class="section level4">
<h4><span class="header-section-number">10.14.2.1</span> Part I</h4>
<p>The dataset for Part I contains the SAT score (out of 1600) and other variables that may be associated with SAT performance for each of the 50 states in the U.S. The data is based on test takers for the 1982 exam. The following variables are in the dataset:</p>
<ul>
<li><strong><code>SAT</code></strong>: average total SAT score</li>
<li><strong><code>State</code></strong>: U.S. State</li>
<li><strong><code>Takers</code></strong>: percentage of high school seniors who took exam</li>
<li><strong><code>Income</code></strong>: median income of families of test-takers ($ hundreds)</li>
<li><strong><code>Years</code></strong>: average number of years test-takers had formal education in social sciences, natural sciences, and humanities</li>
<li><strong><code>Public</code></strong>: percentage of test-takers who attended public high schools</li>
<li><strong><code>Expend</code></strong>: total state expenditure on high schools ($ hundreds per student)</li>
<li><strong><code>Rank</code></strong>: median percentile rank of test-takers within their high school classes</li>
</ul>
</div>
<div id="part-ii" class="section level4">
<h4><span class="header-section-number">10.14.2.2</span> Part II</h4>
<p>The dataset for Part II contains the performance statistics and salaries of Major League Baseball players in the 1986 and 1987 seasons. The data is in the <code>Hitters</code> dataset in the <code>ISLR</code> package. Type <code>?Hitters</code> in the console to see the variables names and their definitions.</p>
</div>
</div>
</div>
<div id="exercises-6" class="section level2">
<h2><span class="header-section-number">10.15</span> Exercises</h2>
<div id="part-i-1" class="section level3">
<h3><span class="header-section-number">10.15.1</span> Part I</h3>
<p>For the first part of the lab, you will return to the model selection activity you started in class using the SAT data. The data is in the <code>case1201</code> data frame in the <code>Sleuth3</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sat_scores &lt;-<span class="st"> </span>case1201 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>State) </code></pre></div>
<ol style="list-style-type: decimal">
<li>Manually perform backward selection using <span class="math inline">\(Adj. R^2\)</span> as the selection criterion. To help you get started, the full model and the code for the first set of models to test are below. Show each step of the selection process. Display the coefficients and <span class="math inline">\(Adj. R^2\)</span> of your final model.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">full_model &lt;-<span class="st"> </span><span class="kw">lm</span>(SAT <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> sat_scores)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m1 &lt;-<span class="st"> </span><span class="kw">lm</span>(SAT <span class="op">~</span><span class="st"> </span>Income <span class="op">+</span><span class="st"> </span>Years <span class="op">+</span><span class="st"> </span>Public <span class="op">+</span><span class="st"> </span>Expend <span class="op">+</span><span class="st"> </span>Rank, <span class="dt">data =</span> sat_scores)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m2 &lt;-<span class="st"> </span><span class="kw">lm</span>(SAT <span class="op">~</span><span class="st"> </span>Takers <span class="op">+</span><span class="st"> </span>Years <span class="op">+</span><span class="st"> </span>Public <span class="op">+</span><span class="st"> </span>Expend <span class="op">+</span><span class="st"> </span>Rank, <span class="dt">data =</span> sat_scores)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m3 &lt;-<span class="st"> </span><span class="kw">lm</span>(SAT <span class="op">~</span><span class="st"> </span>Takers <span class="op">+</span><span class="st"> </span>Income <span class="op">+</span><span class="st"> </span>Public <span class="op">+</span><span class="st"> </span>Expend <span class="op">+</span><span class="st"> </span>Rank, <span class="dt">data =</span> sat_scores)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m4 &lt;-<span class="st"> </span><span class="kw">lm</span>(SAT <span class="op">~</span><span class="st"> </span>Takers <span class="op">+</span><span class="st"> </span>Income <span class="op">+</span><span class="st"> </span>Years <span class="op">+</span><span class="st"> </span>Expend <span class="op">+</span><span class="st"> </span>Rank, <span class="dt">data =</span> sat_scores)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m5 &lt;-<span class="st"> </span><span class="kw">lm</span>(SAT <span class="op">~</span><span class="st"> </span>Takers <span class="op">+</span><span class="st"> </span>Income <span class="op">+</span><span class="st"> </span>Years <span class="op">+</span><span class="st"> </span>Public <span class="op">+</span><span class="st"> </span>Rank, <span class="dt">data =</span> sat_scores)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m6 &lt;-<span class="st"> </span><span class="kw">lm</span>(SAT <span class="op">~</span><span class="st"> </span>Takers <span class="op">+</span><span class="st"> </span>Income <span class="op">+</span><span class="st"> </span>Years <span class="op">+</span><span class="st"> </span>Public <span class="op">+</span><span class="st"> </span>Expend, <span class="dt">data =</span> sat_scores)</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><p>What is the best 5-variable model? Display the model output.</p></li>
<li><p>Use the <code>regsubsets</code> function to perform backward selection. What is the final model when <span class="math inline">\(Adj. R^2\)</span> is the selection criterion? Display the coefficients and the <span class="math inline">\(Adj. R^2\)</span> of the final model. <em>This should be the same result you got in Exercise 1.</em></p></li>
<li><p>What is the final model when <span class="math inline">\(BIC\)</span> is the selection criterion? Display the coefficients and the <span class="math inline">\(BIC\)</span> of the final model.</p></li>
<li>Compare the final models selected by <span class="math inline">\(Adj. R^2\)</span> and <span class="math inline">\(BIC\)</span>.
<ul>
<li>Do the models have the same number of predictors? Briefly explain.</li>
<li>Are the same predictor variables in each model? Briefly explain.</li>
</ul></li>
<li><p>Consider the comparisons made in the previous exercise. Are these differences what you would expect given the selection criteria used? Briefly explain.</p></li>
</ol>
</div>
<div id="part-ii-1" class="section level3">
<h3><span class="header-section-number">10.15.2</span> Part II</h3>
<p>The data for this part of the lab is the <code>Hitters</code> dataset in the <code>ISLR</code> package. Your goal is to fit a regression model that uses the performance statistics of baseball players to predictor their salary. There are 19 potential predictor variables, so you will use the <code>regsubsets</code> function to conduct forward selection to choose a final model.</p>
<ol start="7" style="list-style-type: decimal">
<li><p>Read through the data dictionary for the <code>Hitters</code> dataset. You can access it by typing <code>?Hitters</code> in the console. What is the difference between the variables <code>HmRun</code> and <code>CHmRun</code>?</p></li>
<li><p>Some observations have missing values for <code>Salary</code>. Filter the data, so only observations that have values for <code>Salary</code> are included. You will use this filtered data for the remainder of the lab.</p></li>
<li><p>Fill in the code below to conduct forward selection and save the results in an object called <code>sel_summary</code> (selection summary).</p></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The `nvmax` option indicates the maximum-sized variable subsets to consider in the model selection.</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">regfit_forward &lt;-<span class="st"> </span><span class="kw">regsubsets</span>(_______, ________, <span class="dt">method=</span><span class="st">&quot;forward&quot;</span>, <span class="dt">nvmax =</span> <span class="dv">19</span>)
sel_summary &lt;-<span class="st"> </span><span class="kw">summary</span>(_______)</code></pre></div>
<ol start="10" style="list-style-type: decimal">
<li>The object <code>sel_summary</code> contains the summary statistics for the best fit model containing <span class="math inline">\(k\)</span> predictors, where <span class="math inline">\(k = 1, \ldots, 19\)</span>. The object <code>sel_summary</code> is a list object, so it is cumbersome to extract the relevant summary statistics. Therefore, you can create a data frame called <code>summary_stats</code> such that each row represents the best fit model with <span class="math inline">\(k\)</span> predictors and each column is a summary statistic. For example, the second row contains the summary statistics of the best fit model that contains 2 variables.</li>
</ol>
<p>Fill in the code below to create the data frame <code>summary_stats</code> that includes the <span class="math inline">\(BIC\)</span>, <span class="math inline">\(R^2\)</span>, <span class="math inline">\(Adj. R^2\)</span>, and residual sum of squares (RSS) for each model in <code>sel_summary</code>. The data frame <code>summary_stats</code> will also include the column <code>np</code>, the number of predictors in the model represented on each row.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summary_stats &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">bic =</span> sel_summary<span class="op">$</span>bic, 
                       <span class="dt">adjr2 =</span> _______, 
                       <span class="dt">rsq =</span> _______,
                       <span class="dt">rss =</span> _______) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">np =</span> <span class="kw">row_number</span>()) <span class="co">#number of variables</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># See the [ggplot2 documentation](https://ggplot2.tidyverse.org/reference/geom_abline.html#arguments) for code to add a vertical line.</span></code></pre></div>
<ol start="11" style="list-style-type: decimal">
<li>Use the data in the <code>summary_stats</code> data frame to plot <span class="math inline">\(BIC\)</span> versus the number of predictors. Include a vertical line on your plot that shows the number of predictors for the overall final model you would select based on <span class="math inline">\(BIC\)</span>. Be sure your plot has clear and informative title and axes labels.
<ul>
<li>How does <span class="math inline">\(BIC\)</span> change as the number of predictors increases?</li>
<li>How many predictors are in the final model selected based on <span class="math inline">\(BIC\)</span>?</li>
</ul></li>
</ol>
<p><em>You can fill in the code below with either <code>max</code> or <code>min</code> to find the number of predictors in the final model selected based on <span class="math inline">\(BIC\)</span>.</em></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">np_bic &lt;-<span class="st"> </span>summary_stats <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(bic <span class="op">==</span><span class="st"> </span><span class="kw">_____</span>(bic)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(np) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">pull</span>()</code></pre></div>
<ol start="12" style="list-style-type: decimal">
<li>Use the data in the <code>summary_stats</code> data frame to plot <span class="math inline">\(Adj. R^2\)</span> versus the number of predictors. Include a vertical line on your plot that shows the number of predictors for the final model you would select based on <span class="math inline">\(Adj. R^2\)</span>. Be sure your plot has clear and informative title and axes labels.
<ul>
<li>How does <span class="math inline">\(Adj. R^2\)</span> change as the number of predictors increases?</li>
<li>How many predictors are in the final model selected based on <span class="math inline">\(Adj. R^2\)</span>?</li>
</ul></li>
<li>Use the data in the <code>summary_stats</code> data frame to plot <span class="math inline">\(R^2\)</span> versus the number of predictors. Include a vertical line on your plot that shows the number of predictors for the final model selected based on <span class="math inline">\(R^2\)</span>. Be sure your plot has clear and informative title and axes labels.
<ul>
<li>How does <span class="math inline">\(R^2\)</span> change as the number of predictors increases?</li>
<li>How many predictors are in the final model selected based on <span class="math inline">\(R^2\)</span>?</li>
</ul></li>
<li><p>Should <span class="math inline">\(R^2\)</span> be used as a model selection criterion? Briefly explain why or why not using your answers to Exercises 11 - 13.</p></li>
<li><p>Choose a final model to predict a baseball player’s <code>Salary</code> from his performance statistics. Display the variables, their coefficients, and the summary statistics from the <code>summary_stats</code> data frame for this model.</p></li>
<li>Briefly explain why you chose the model in the previous exercise.
<ul>
<li>Which model selection criteria did you use (<span class="math inline">\(BIC\)</span>, <span class="math inline">\(Adj. R^2\)</span>, <span class="math inline">\(R^2\)</span>)? Why?</li>
<li>What other factors did you consider besides the value of the model selection criteria?</li>
</ul></li>
</ol>
</div>
<div id="acknowledgements" class="section level3">
<h3><span class="header-section-number">10.15.3</span> Acknowledgements</h3>
<p>Part II of this lab was inspired by Lab 6.5 in <a href="http://www-bcf.usc.edu/~gareth/ISL/">An Introduction to Statistical Learning</a> and <a href="https://www.andrew.cmu.edu/user/achoulde/95791/homework/homework3.html">Variable Selection in Regression</a>.</p>

</div>
</div>
<div id="logistic-regression" class="section level2">
<h2><span class="header-section-number">10.16</span> Logistic Regression</h2>
<p>Over the past ten years, recommendation systems have become increasingly popular as more companies strive to offer customized user experiences. Amazon recommends products you may like based on your browse and purchase history, Netflix recommends movies and TV shows based on your viewing history, and music platforms like Spotify recommend songs you may like based on your listening history. While these recommendation systems are built using a variety of algorithms, they are all trying to achieve the same goal: use the characteristics of the products/movies/music a user is known to like to figure out the products/movies/music the user may like but hasn’t discovered yet.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># See [&quot;How Does Spotify Know You So Well?&quot;](https://medium.com/s/story/spotifys-discover-weekly-how-machine-learning-finds-your-new-music-19a41ab76efe) for more information about Spotify&#39;s recommendation algorithms.</span></code></pre></div>
<p>In today’s lab, we will focus on using the characteristics of songs a user previously played to determine whether or not a user will like a new song. We will use logistic regression to build a model that predicts the probability a user likes a song using the relevant characteristics of that song.</p>
<div id="packages-7" class="section level3">
<h3><span class="header-section-number">10.16.1</span> Packages</h3>
<p>You will need the following packages for today’s lab:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(broom)
## Fill in other packages as needed</code></pre></div>
</div>
<div id="data-7" class="section level3">
<h3><span class="header-section-number">10.16.2</span> Data</h3>
<p>The data in this lab is from the <a href="https://www.kaggle.com/geomack/spotifyclassification">Spotify Song Attributes</a> data set in Kaggle. This data set contains song characteristics of 2017 songs played by a single user and whether or not he liked the song. Since this dataset contains the song preferences of a single user, the scope of the analysis is limited to this particular user.</p>
<p>You will use data <code>spotify.csv</code> to build the logistic regression model and test the performance of the model using the songs in <code>test_songs.csv</code>. Click <a href="https://www2.stat.duke.edu/courses/Spring19/sta210.001/labs/data/spotify.csv"><strong>here</strong></a> to download the dataset <code>spotify.csv</code>, and click <a href="https://www2.stat.duke.edu/courses/Spring19/sta210.001/labs/data/test_songs.csv"><strong>here</strong></a> to download the dataset <code>test_songs.csv</code>. Upload both files to the to the <code>data</code> folder in your <code>lab-07</code> project.</p>
<p>The <a href="https://developer.spotify.com/documentation/web-api/reference/tracks/get-audio-features/">Spotify documentation page</a> contains a description of the variables included in this dataset.</p>
</div>
</div>
<div id="exercises-7" class="section level2">
<h2><span class="header-section-number">10.17</span> Exercises</h2>
<div id="exploratory-data-analysis-2" class="section level3">
<h3><span class="header-section-number">10.17.1</span> Exploratory Data Analysis</h3>
<ol style="list-style-type: decimal">
<li>Read through the <a href="https://developer.spotify.com/documentation/web-api/reference/tracks/get-audio-features/">Spotify documentation page</a> to learn more about the variables in the dataset. The response variable for this analysis is <code>like</code>, such that 1 indicates that the user likes the song and 0 otherwise. The remaining will be considered as predictor variables in the model.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Part of the code to make `x` a factor. </span>

<span class="co"># mutate(x = factor(x))</span></code></pre></div>
<pre><code>- Which potential predictor variables are categorical? You only need to include the variables that are in the dataset.
- Recode the each of the categorical predictors so they are a `factor` variable type.</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><p>Choose a quantitative predictor variable. Make the appropriate plot of the response versus this predictor variable. Describe the relationship between the two variables.</p></li>
<li><p>Choose a categorical predictor variable. Make the appropriate plot of the response versus this predictor variable. Describe the relationship between the two variables.</p></li>
<li><p>Let’s consider a potential interaction effect between the variables you choose in Exercises 2 and 3. Make the appropriate plots to examine the potential interaction effect. Do these plots suggest there is a significant interaction effect? Briefly explain.</p></li>
</ol>
<p><em>In practice, you should do exploratory data analysis for all potential explanatory variables. We did an abbreviated exploratory data analysis to make the assignment more manageable.</em></p>
</div>
<div id="part-ii-logistic-regression-model" class="section level3">
<h3><span class="header-section-number">10.17.2</span> Part II: Logistic Regression Model</h3>
<ol start="5" style="list-style-type: decimal">
<li><p>Fit the full model and display the model output. The main objective for the model is to predict whether the user will like a song. Should we use this model for this objective? Briefly explain.</p></li>
<li><p>Use the <code>step</code> function to perform backward selection. Display the output for the selected model.</p></li>
<li><p>Briefly describe the criteria used by <code>step</code> to select the final model.</p></li>
</ol>
<p>For the remainder of this lab, you will use the model chosen by model selection . In practice; however, you would not just stop with the results from the automated model selection procedure and would examine the model further to see if there are any significant interactions, higher-order terms, or if it could even be simplified.</p>
<ol start="8" style="list-style-type: decimal">
<li><p>Consider the variable <code>duration_ms</code>.</p>
<ul>
<li>Interpret the coefficient of <code>duration_ms</code> and its 95% confidence interval in terms of the odds of the user liking a song.</li>
<li>Suppose instead of <code>duration_ms</code>, we use the variable <code>duration_s</code>, the duration of a song in seconds. What would be the effect of <code>duration_s</code> on the odds of the user liking a song? Include the updated coefficient and corresponding 95% confidence interval for <code>duration_s</code>. <em>Assume all other variables in the model are unchanged.</em></li>
</ul></li>
<li><p>Interpret <code>mode</code> and its 95% confidence interval in terms of the odds of the user liking a song.</p>
<ul>
<li>Based on this model, is there evidence of a significant difference in the user’s preference between songs in a major key versus those in a minor key?</li>
</ul></li>
</ol>
</div>
<div id="part-iii-model-assessment" class="section level3">
<h3><span class="header-section-number">10.17.3</span> Part III: Model Assessment</h3>
<p>In the next few questions, we will do an abbreviated analysis of the residuals.</p>
<ol start="10" style="list-style-type: decimal">
<li><p>Create a binned plot of the residuals versus the predicted probabilities. <em>You will first need to use the <code>augment</code> function with the options <code>type.predict = &quot;response&quot;</code> and <code>type.residuals = &quot;response&quot;</code> to get the predicted probabilities and corresponding residuals.</em></p></li>
<li><p>Choose a quantitative predictor in the final model. Make the appropriate table or plot to examine the residuals versus this predictor variable.</p></li>
<li><p>Choose a categorical predictor in the final model. Make the appropriate table or plot to examine the residuals versus this predictor variable.</p></li>
</ol>
<p><em>In practice, you should examine plots of residuals versus <u>every</u> predictor variable to make a complete assessment of the model fit. For the sake of time on the lab, you will use these three plots to help make the assessment in Exercise 14.</em></p>
<ol start="13" style="list-style-type: decimal">
<li><p>Plot the ROC curve and find the area under the curve.</p></li>
<li><p>Based on the residual plots and the ROC curve, is this logistic model a good fit for the data? Briefly explain.</p></li>
</ol>
</div>
<div id="part-iv-prediction" class="section level3">
<h3><span class="header-section-number">10.17.4</span> Part IV: Prediction</h3>
<ol start="15" style="list-style-type: decimal">
<li>You are part of the data science team at Spotify, and your model will be used to make song recommendations to users. The goal is to recommend songs the user has a high probability of liking.</li>
</ol>
<p>As a group, choose a threshold value to distinguish between songs the user will like and those the user won’t like. What is your threshold value? Use the ROC curve to help justify your choice.</p>
<ol start="16" style="list-style-type: decimal">
<li><p>Now let’s put your model and decision threshold to the test! Use your model to calculate the predicted probability that the user will like the following two songs:</p>
<ul>
<li>“Sign of the Times” by Harry Styles</li>
<li>“Hotline Bling” by Drake</li>
</ul></li>
</ol>
<p>The data for the songs can be found in <em>test_songs.csv</em>.</p>
<ol start="17" style="list-style-type: decimal">
<li><p>Using your decision threshold from Question 15, would you recommend “Sign of the Times” to this user? Would your recommend “Hotline Bling” to this user? Briefly explain your decision.</p></li>
<li><p>The user likes “Hotline Bling” but doesn’t like “Sign of the Times”. How good were your recommendations based on these two songs?</p>
<ul>
<li>If they were good recommendations, explain how the model and threshold helped you distinguish between songs the user would like and those he wouldn’t.</li>
<li>If they were not good recommendations, explain the limitations in your model and/or threshold.</li>
</ul></li>
</ol>

</div>
</div>
<div id="multinomial-logistic-regression" class="section level2">
<h2><span class="header-section-number">10.18</span> Multinomial Logistic Regression</h2>
<p>The General Social Survey (GSS) has been used to measure trends in attitudes and behaviors in American society since 1972. In addition to collecting demographic information, the survey includes questions used to gauge attitudes about government spending priorities, confidence in institutions, lifestyle, and many other topics. A full description of the survey may be found <a href="http://www.norc.org/Research/Projects/Pages/general-social-survey.aspx">here</a>.</p>
<p>In today’s lab, we will use multinomial logistic regression to understand the relationship between a person’s political views and their attitudes towards government spending on mass transportation projects. To do so, we will use data from the 2010 GSS survey. Refer to the <a href="https://www2.stat.duke.edu/courses/Spring19/sta210.001/slides/lec-slides/18-multinomial-logistic-pt2.html#1">Multinomial Logistic Regression notes</a> for help with concepts and code.</p>
<div id="packages-8" class="section level3">
<h3><span class="header-section-number">10.18.1</span> Packages</h3>
<p>You will need the following packages for today’s lab:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(nnet)
<span class="kw">library</span>(knitr)
<span class="kw">library</span>(broom)
## Fill in other packages as needed</code></pre></div>
</div>
<div id="data-8" class="section level3">
<h3><span class="header-section-number">10.18.2</span> Data</h3>
<p>The data for this lab is from the 2016 General Social Survey. The original data set contains 2867 observations and 935 variables. Given the size of the dataset, we will handle it differently in our workflow than we’ve handled data in previous assignments.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># [Working with large files](https://help.github.com/en/articles/working-with-large-files)</span></code></pre></div>
<p>The size of this dataset is 34.3 MB. Compare that to the Spotify dataset from last weeks’ lab which was 149 KB (0.149 MB)! GitHub will not allow you to push files larger than 100 MB and will give you a warning when you push files as large as 50 MB. Though we could push the file we’re working with today to GitHub, it’s large enough that we’d still prefer not to.</p>
<p>You have may noticed that each repo contains a file called <code>.gitignore</code>. It contains a list of the files you don’t want commit or push to GitHub. If you look at the <code>.gitignore</code> file for today’s lab, you will notice that <code>gss2016.csv</code> is listed at the bottom.</p>
<ul>
<li>Click <a href="https://www2.stat.duke.edu/courses/Spring19/sta210.001/labs/data/gss2016.csv"><strong>here</strong></a> to download <code>gss2016.csv</code>.</li>
<li>Upload <code>gss2016.csv</code> into the data folder of your project.</li>
<li>Notice that <code>gss2016.csv</code> does not appear in your Git pane. This is because it is being ignored by git, since it is listed in the <code>.gitignore</code> file.</li>
</ul>
<p>You will use the following variables in the lab:</p>
<ul>
<li><p><code>natmass</code>: Respondent’s answer to the following prompt:</p>
<p>“We are faced with many problems in this country, none of which can be solved easily or inexpensively. I’m going to name some of these problems, and for each one I’d like you to tell me whether you think we’re spending too much money on it, too little money, or about the right amount…are we spending too much, too little, or about the right amount on mass transportation?”</p></li>
<li><code>age</code>: Age in years.</li>
<li><code>sex</code>: Sex recorded as <em>male</em> or <em>female</em></li>
<li><code>sei10</code>: Socioeconomic index from 0 to 100</li>
<li><code>region</code>: Region where interview took place</li>
<li><p><code>polviews</code>: Respondent’s answer to the following prompt:</p>
<p>“We hear a lot of talk these days about liberals and conservatives. I’m going to show you a seven-point scale on which the political views that people might hold are arranged from extremely liberal - point 1 - to extremely conservative - point 7. Where would you place yourself on this scale?”</p></li>
</ul>
<p>Use the code below to read in the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gss &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/gss2016.csv&quot;</span>,
  <span class="dt">na =</span> <span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;Don&#39;t know&quot;</span>, <span class="st">&quot;No answer&quot;</span>, 
         <span class="st">&quot;Not applicable&quot;</span>), 
         <span class="dt">guess_max =</span> <span class="dv">2867</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(natmass, age, sex, sei10, region, polviews) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">drop_na</span>()</code></pre></div>
<p>The argument <code>guess_max = 2867</code> tells the <code>read_csv</code> function to use all of the observations in a column to determine its data type. Without this argument, only the first 1,000 observations would be used to make this determination. This becomes important for a variable like <code>age</code>; though <code>age</code> is coded as numeric data for most of the observations, there are some in which <code>age</code> is coded as <code>&quot;89 or older&quot;</code>. Without the <code>guess_max</code> argument, you will get warnings when loading the data.</p>
<p>Note also that only the variables of interest will be loaded, not the entire dataset. This will make for faster computation and knitting as you work on the lab.</p>
</div>
</div>
<div id="exercises-8" class="section level2">
<h2><span class="header-section-number">10.19</span> Exercises</h2>
<div id="part-i-exploratory-data-analysis" class="section level3">
<h3><span class="header-section-number">10.19.1</span> Part I: Exploratory Data Analysis</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># See [Reorder factor levels by hand](https://forcats.tidyverse.org/reference/fct_relevel.html) for documentation about `fct_relevel`.</span></code></pre></div>
<ol style="list-style-type: decimal">
<li><p>The variable <code>natmass</code> will be the response variable in the model, and you want to compare more opinionated views to the moderate position. Recode <code>natmass</code> so it is a factor variable with <code>&quot;About right&quot;</code> as the baseline.</p></li>
<li><p>Recode <code>polviews</code> so it is a factor variable type with levels that are in an order that is consistent with question on the survey. <em>Note how the categories are spelled in the data.</em></p></li>
</ol>
<p>Make a plot of the distribution of <code>polviews</code>. Which political view occurs most frequently in this data set?</p>
<ol start="3" style="list-style-type: decimal">
<li><p>Make a plot displaying the relationship between <code>natmass</code> and <code>polviews</code>. Use the plot to describe the relationship between a person’s political views and their views on mass transportation spending.</p></li>
<li><p>You want to use <code>age</code> as a quantitative variable in your model; however, it is currently a character data type because some observations are coded as <code>&quot;89 or older&quot;</code>. Recode <code>age</code> so that is a numeric variable. <em>Note: Before making the variable numeric, you will need to replace the values <code>&quot;89 or older&quot;</code> with a single value.</em></p></li>
</ol>
</div>
<div id="part-ii-multinomial-logistic-regression-model" class="section level3">
<h3><span class="header-section-number">10.19.2</span> Part II: Multinomial Logistic Regression Model</h3>
<ol start="5" style="list-style-type: decimal">
<li><p>You plan to fit a model using <code>age</code>, <code>sex</code>, <code>sei10</code>, and <code>region</code> to understand variation in opinions about spending on mass transportation. Briefly explain why you should fit a multinomial logistic model.</p></li>
<li><p>Fit the model described in the previous exercise and display the model output. Make any necessary adjustments to the variables so the intercept will have a meaningful interpretation. Be sure <code>About Right</code> is the baseline level. Be sure the full model displays in the knitted document.</p></li>
<li><p>Interpret the intercept associated with <u>odds</u> of having an opinion of “Too much” versus “About right”.</p></li>
<li><p>Consider the relationship between age and one’s opinion about spending on mass transportation.</p>
<ul>
<li>Interpret the coefficient of age in terms of the <u>log odds</u> of having an opinion of “Too little” versus “About right”.</li>
<li>Interpret the coefficient of age in terms of the <u>odds</u> of having an opinion of “Too little” versus “About right”.</li>
</ul></li>
<li><p>In general, what is the relationship between an person’s age and their opinions on mass transportation spending?</p></li>
</ol>
<p>Now that you have adjusted for some demographic factors, let’s examine whether a person’s political views has a significant impact on their attitude towards spending on mass transportation.</p>
<ol start="10" style="list-style-type: decimal">
<li>Conduct the appropriate test to determine if <code>polviews</code> is a significant predictor of attitude towards spending on mass transportation. State the null and alternative hypothesis, display all relevant code and output, and state your conclusion in the context of the problem.</li>
</ol>
<p>Choose the appropriate model based on the results from the test. Use this model for the next part of the lab.</p>
</div>
<div id="part-iii-model-fit" class="section level3">
<h3><span class="header-section-number">10.19.3</span> Part III: Model Fit</h3>
<ol start="11" style="list-style-type: decimal">
<li><p>Calculate the predicted probabilities and residuals from your model.</p></li>
<li><p>Plot the binned residuals versus the predicted probabilities for each category of <code>natmass.</code> <em>You will have three plots.</em></p></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># You can change the size of your plots, so you can fit multiple plots on a single page. Include the arguments `fig.height = ` and `fig.width = ` in the header of the code chunk to change the plot size. </span>

<span class="co"># See [Using R Markdown](https://rstudio.github.io/dygraphs/r-markdown.html) for an example.</span></code></pre></div>
<ol start="13" style="list-style-type: decimal">
<li><p>Use binned residual plots to examine the residuals versus each of the quantitative variables.</p>
<ul>
<li>Create binned plots of the residuals for each category of <code>natmass</code> versus <code>age</code>. <em>You will have three plots.</em></li>
<li>Create binned plots of the residuals for each category of <code>natmass</code> versus <code>sei10</code>. <em>You will have three plots.</em></li>
</ul></li>
<li><p>To examine the residuals versus each categorical predictor, you will look at the average residuals for each each category of the categorical variables.</p>
<ul>
<li>For each level of <code>natmass</code>, calculate the average residuals across categories of <code>sex</code>.</li>
<li>For each category of <code>natmass</code>, calculate the average residuals across categories of <code>region</code>.</li>
<li>For each category of <code>natmass</code>, calculate the average residuals across categories of <code>polviews</code>.</li>
</ul></li>
<li><p>Based on the analysis of the residuals in Exercises 12 - 14, is the model an appropriate fit for the data? Explain.</p></li>
</ol>
<p><em>Regardless of your asssesment of the residuals, use your model for the remainder of the lab.</em></p>
</div>
<div id="part-iv-using-the-model" class="section level3">
<h3><span class="header-section-number">10.19.4</span> Part IV: Using the Model</h3>
<ol start="16" style="list-style-type: decimal">
<li><p>Use your model to describe the relationship between one’s political views and their attitude towards spending on mass transportation.</p></li>
<li><p>Use your model to predict the category of <code>natmass</code> for each observation in your dataset. Display a table of the actual versus the predicted <code>natmass</code>. What is the misclassification rate?</p></li>
</ol>
</div>
<div id="acknowledgements-1" class="section level3">
<h3><span class="header-section-number">10.19.5</span> Acknowledgements</h3>
<p>The “Data” section is largely inspired by <a href="https://datasciencebox.org/">datasciencebox.org</a>.</p>

</div>
</div>
<div id="putting-it-all-together" class="section level2">
<h2><span class="header-section-number">10.20</span> Putting It All Together</h2>
<p>In this lab, you will put together everything you’ve learned thus far. Unlike previous lab assignments, your lab write up will be in the form of a small report (rather than numbered exercises). Though this analysis will not be as in-depth as your analysis in the final project, this assignment will give your group practice organizing the results of a statistical analysis to tell a complete narrative.</p>
<p>You will also practice imputing missing data and using k-fold cross validation to assess your model’s performance on test data.</p>
<div id="packages-9" class="section level3">
<h3><span class="header-section-number">10.20.1</span> Packages</h3>
<p>You will need the following packages for today’s lab:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(dslabs)
## Fill in other packages as needed</code></pre></div>
</div>
<div id="data-9" class="section level3">
<h3><span class="header-section-number">10.20.2</span> Data</h3>
<p>The data for this lab is the <code>gapminder</code> dataset in the <strong>dslabs</strong> package. This dataset contains health and income data for 184 countries during the years 1960 to 2016. After loading the dslabs package, you can type <code>?gapminder</code> in the console to to see the variables in the dataset.</p>
<p><strong>You will only use data from 2011 in this lab.</strong></p>
</div>
<div id="exercises-9" class="section level3">
<h3><span class="header-section-number">10.20.3</span> Exercises</h3>
<p>The goal of this analysis is to build a regression model that could be used to predict a country’s gross domestic product (<code>gdp</code>) using the other characteristics included in the data.</p>
<p><strong><u>Introduction</u></strong></p>
<p>Brief introduction of the data and the research question</p>
<p><strong><u>Exploratory Data Analysis</u></strong></p>
<p>At a minimum, your exploratory data analysis should include the following:</p>
<ul>
<li>Analysis of each variable</li>
<li>Dealing with missing values using imputation methods</li>
<li>Analysis of the relationships between variables</li>
<li>Discussion of any potential transformations, if needed</li>
</ul>
<p><strong><u>Regression Model</u></strong></p>
<p>At a minimum, the discussion for the final regression model should include the following:</p>
<ul>
<li>Brief discussion about the type of model you used (multiple linear regression, logistic, multinomial logistic regression) and why</li>
<li>Discussion of any transformations on the response and/or explanatory variables, if applicable</li>
<li>Display of the final model</li>
<li>Test of interesting interactions</li>
<li>Conclusions drawn from the model, including any interesting insights based on the model coefficients</li>
</ul>
<p><strong><u>Assumptions</u></strong></p>
<p>At a minimum, the discussion of model assumptions should include the following:</p>
<ul>
<li>Appropriate residual plots</li>
<li>Check for influential points</li>
<li>Check for multicollinearity</li>
<li>Discussion of whether or not assumptions are met and how any issues may affect conclusions drawn from the model</li>
</ul>
<p><strong><u>Model Validation</u></strong></p>
<p>At a minimum, the discussion of the model validation should include the following:</p>
<ul>
<li>Results and discussion from a 5-fold cross validation</li>
</ul>
<p><strong><u>Conclusion</u></strong></p>
<p>Brief summary of the conclusions drawn from the analysis.</p>

</div>
</div>
<div id="movies-analysis" class="section level2">
<h2><span class="header-section-number">10.21</span> Movies Analysis</h2>
<p>We will look at the relationship between budget and revenue for movies made in the United States in 1986 to 2016. The data is from the <a href="https://www.imdb.com/">Internet Movie Database (IMDB)</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)
<span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(DT)</code></pre></div>
</div>
<div id="data-10" class="section level2">
<h2><span class="header-section-number">10.22</span> Data</h2>
<p>The <code>movies</code> data set includes basic information about each movie including budget, genre, movie studio, director, etc. A full list of the variables may be found <a href="https://github.com/danielgrijalva/movie-stats">here</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">movies &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/danielgrijalva/movie-stats/master/movies.csv&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">movies &lt;-<span class="st"> </span>movies <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(country<span class="op">==</span><span class="st">&quot;USA&quot;</span>, 
         <span class="op">!</span>(genre <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Musical&quot;</span>,<span class="st">&quot;War&quot;</span>,<span class="st">&quot;Western&quot;</span>))) <span class="co">#remove genres with &lt; 10 movies</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">movies</code></pre></div>
</div>
<div id="analysis-1" class="section level2">
<h2><span class="header-section-number">10.23</span> Analysis</h2>
<div id="part-1" class="section level3">
<h3><span class="header-section-number">10.23.1</span> Part 1</h3>
<p>We begin by looking at how the gross revenue (<code>gross</code>) has changed over time. Since we want to visualize the results, we will choose a few genres of interest for the analysis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">genre_list &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Horror&quot;</span>, <span class="st">&quot;Drama&quot;</span>, <span class="st">&quot;Action&quot;</span>, <span class="st">&quot;Animation&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">movies <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(genre <span class="op">%in%</span><span class="st"> </span>genre_list) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(genre,year) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">avg_gross =</span> <span class="kw">mean</span>(gross)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> avg_gross, <span class="dt">color=</span>genre)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">ylab</span>(<span class="st">&quot;Average Gross Revenue (in US Dollars)&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="st">&quot;Gross Revenue Over Time&quot;</span>)</code></pre></div>
</div>
<div id="part-2" class="section level3">
<h3><span class="header-section-number">10.23.2</span> Part 2</h3>
<p>Next, let’s see the relationship between a movie’s budget and its gross revenue. Because there is a large range of values for budget and revenue, we will plot the log-transformed version of each variable to more easily visualize the relationship. We will talk more about variable transformations later in the semester.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">movies <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(genre <span class="op">%in%</span><span class="st"> </span>genre_list, budget <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">log</span>(budget), <span class="dt">y =</span> <span class="kw">log</span>(gross), <span class="dt">color=</span>genre)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>,<span class="dt">se=</span><span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Log-transformed Budget&quot;</span>)<span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Log-transformed Gross Revenue&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>genre)</code></pre></div>
</div>
</div>
<div id="next-steps" class="section level2">
<h2><span class="header-section-number">10.24</span> Next Steps</h2>
<ol style="list-style-type: decimal">
<li><p>Put your name in the author field at the top of the file (in the <code>yaml</code> – we will discuss what this is at a later date). Knit again.</p></li>
<li><p>Change the genre names in parts 1 and 2 to genres that interest you. The spelling and capitalization must match what’s in the data, so you can use the <a href="intro-to-r.html#appendix">Appendix</a> to see the correct spelling and capitalization. Knit again.</p></li>
</ol>
<p>You have made your first data visualization!</p>
</div>
<div id="discussion-questions" class="section level2">
<h2><span class="header-section-number">10.25</span> Discussion Questions</h2>
<ol style="list-style-type: decimal">
<li>Consider the plot in Part 1.
<ul>
<li>Describe how movie revenue has changed over time.</li>
<li>Suppose we use revenue as a measure of popularity. How has the popularity of each genre changed over time? In other words, are the genres that were most popular in 1986 still the most popular today?</li>
</ul></li>
<li>Consider the plot in Part 2.
<ul>
<li>Which genre(s) tend to have the highest budgets?</li>
<li>In general, what is the relationship between a movie’s budget and its total revenue? Are there any genres that show a different relationship between budget and revenue?</li>
</ul></li>
</ol>
</div>
<div id="references" class="section level2">
<h2><span class="header-section-number">10.26</span> References</h2>
<ol style="list-style-type: decimal">
<li><a href="https://github.com/danielgrijalva/movie-stats" class="uri">https://github.com/danielgrijalva/movie-stats</a></li>
<li><a href="https://www.imdb.com/">Internet Movie Database</a></li>
</ol>
</div>
<div id="appendix" class="section level2">
<h2><span class="header-section-number">10.27</span> Appendix</h2>
<p>Below is a list of genres in the data set:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">movies <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(genre) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(genre) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">datatable</span>()</code></pre></div>

</div>
<div id="in-class-exercise-advertising-analysis-1" class="section level2">
<h2><span class="header-section-number">10.28</span> In-Class Exercise: Advertising Analysis</h2>
<p>In this mini analysis, we will work with the <code>Advertising</code> data used in Chapters 2 and 3 of <em>Introduction to Statistical Learning</em>.</p>
<div id="data-and-packages-1" class="section level3">
<h3><span class="header-section-number">10.28.1</span> Data and packages</h3>
<p>We start with loading the packages we’ll use.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)
<span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(skimr)
<span class="kw">library</span>(broom)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">advertising &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/advertising.csv&quot;</span>)</code></pre></div>
<p>We will analyze the advertising and sales data for 200 markets. The variables we’ll use are</p>
<ul>
<li><code>tv</code>: total spending on TV advertising (in $thousands)</li>
<li><code>radio</code>: total spending on radio advertising (in $thousands)</li>
<li><code>newspaper</code>: total spending on newspaper advertising (in $thousands)</li>
<li><code>sales</code>: total sales (in $millions)</li>
</ul>
</div>
<div id="analysis-2" class="section level3">
<h3><span class="header-section-number">10.28.2</span> Analysis</h3>
<p>We’ll begin the analysis by getting quick view of the data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(advertising)</code></pre></div>
<p>Next, we can calculate summary statistics for each of the variables in the data set.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">advertising <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">skim</span>()</code></pre></div>
<ol style="list-style-type: decimal">
<li><p>What type of advertising has the smallest median spending?</p></li>
<li><p>What type of advertising has the largest variation in spending?</p></li>
<li><p>Describe the shape of the distribution of <code>sales</code>.</p></li>
</ol>
<p>We are most interested in understanding how advertising spending affect sales. One way to quantify the relationship between the variables is by calculating the correlation matrix.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">advertising <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">cor</span>()</code></pre></div>
<ol style="list-style-type: decimal">
<li><p>What is the correlation between <code>radio</code> and <code>sales</code>? Interpret this value.</p></li>
<li><p>What type of advertising has the strongest linear relationship with <code>sales</code>?</p></li>
</ol>
<p>Below are visualizations of <code>sales</code> versus each explanatory variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">advertising <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x=</span>tv,<span class="dt">y=</span>sales)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.7</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>,<span class="dt">se=</span><span class="ot">FALSE</span>,<span class="dt">color=</span><span class="st">&quot;blue&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Sales vs. TV Advertising&quot;</span>, 
       <span class="dt">x=</span> <span class="st">&quot;TV Advertising (in $thousands)&quot;</span>, 
       <span class="dt">y=</span><span class="st">&quot;_____&quot;</span>) <span class="co">#fill in the Y axis label</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">advertising <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x=</span>radio,<span class="dt">y=</span>sales)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.7</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>,<span class="dt">se=</span><span class="ot">FALSE</span>,<span class="dt">color=</span><span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Sales vs. TV Advertising&quot;</span>, 
       <span class="dt">x=</span> <span class="st">&quot;Radio Advertising (in $thousands)&quot;</span>, 
       <span class="dt">y=</span><span class="st">&quot;Sales (in $millions)&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">advertising <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x=</span>newspaper,<span class="dt">y=</span>sales)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.7</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>,<span class="dt">se=</span><span class="ot">FALSE</span>,<span class="dt">color=</span><span class="st">&quot;purple&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Sales vs. Newspaper Advertising&quot;</span>, 
       <span class="dt">x=</span> <span class="st">&quot;Newspaper Advertising (in $thousands)&quot;</span>, 
       <span class="dt">y=</span><span class="st">&quot;Sales (in $millions)&quot;</span>)</code></pre></div>
<p>Since <code>tv</code> appears to have the strongest linear relationship with <code>sales</code>, let’s calculate a simple linear regression model using these two variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ad_model &lt;-<span class="st"> </span><span class="kw">lm</span>(sales <span class="op">~</span><span class="st"> </span>tv, <span class="dt">data=</span>advertising)
ad_model</code></pre></div>
<ol style="list-style-type: decimal">
<li><p>Write the model equation.</p></li>
<li><p>Interpret the intercept in the context of the problem.</p></li>
<li><p>Interpret the slope in the context of the problem.</p></li>
</ol>

</div>
</div>
<div id="in-class-exercise-beer-data-analysis-1" class="section level2">
<h2><span class="header-section-number">10.29</span> In-Class Exercise: Beer Data Analysis</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(readr)
<span class="kw">library</span>(broom)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">beer &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/beer.csv&quot;</span>)</code></pre></div>
<p>In this analysis, we will analyze the relationship between the amount of alcohol (<code>PercentAlcohol</code>) and the caloric content (<code>CaloriesPer12Oz</code>) in domestic beers. Let <code>PercentAlcohol</code> be the predictor variable and <code>CaloriesPer12Oz</code> the response variable.</p>
<p>Due to limited class time, we will not do the exploratory data analysis in this example. In practice, however, you should always start with the exploratory data analysis.</p>
<p><em>You can add your answers to this R Markdown document</em>.</p>
<p><em>1. Calculate a regression model to describe the relationship between <code>PercentAlcohol</code> and <code>CaloriesPer12Oz</code>. Display the model output.</em></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model &lt;-<span class="st"> </span><span class="kw">lm</span>(CaloriesPer12Oz <span class="op">~</span><span class="st"> </span>PercentAlcohol, <span class="dt">data=</span>beer)
model <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tidy</span>(<span class="dt">conf.int=</span><span class="ot">TRUE</span>)</code></pre></div>
<p><strong>2. Does it make sense to interpret the intercept? Why or why not?</strong></p>
<p>There are non-alocoholic beers, so it is possible to have a meaningful interpretation of the intercept. In our data, however, there are very few beers with less than 3% alcoholic content, so it would not be wise to interpret the intercept. It is not safe to assume the same relationship between <code>PercentAlcohol</code> and <code>CaloriesPer12Oz</code> hold for beers with 0% alcohol; this would be extrapolation.</p>
<p><strong>3. Interpret the 95% confidence interval for the slope in the context of the data.</strong></p>
<p>We are 95% confident that the interval (26.557, 30.620) contains the true population slope for <code>PercentAlcohol</code>. This means we are 95% confident that for every 1% increase in alcohol content, the number of calories (per 12 oz) is expected to increase between 26.557 and 30.620 calories.</p>
<p><strong>4. Find the critical value, <span class="math inline">\(t^*\)</span>, used to calculate the 95% confidence interval. The code below is a guide; uncomment and complete the lines of code to calculate and display the critical value.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">n &lt;-<span class="st"> </span><span class="kw">nrow</span>(beer)

df &lt;-<span class="st"> </span>n<span class="op">-</span><span class="dv">2</span>
crit_val &lt;-<span class="st"> </span><span class="kw">qt</span>(<span class="fl">0.975</span>,df)</code></pre></div>
<p>The critical value used to calculate the 95% confident interval for the slope is ______.</p>
<p><strong>5. Interpret the test statistic in the context of the data</strong></p>
<p>The estimated slope of 28.577 is 27.78 standard errors above the hypothesized mean of 0, assuming there is no linear relationship between percent alcohol and calories in domestic beers.</p>
<p><strong>6. How was the p-value calculated? Fill in the code below to calculate the p-value. The code below is a guide; uncomment and complete the lines of code to calculate and display the p-value.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">test_statistic &lt;-<span class="st"> </span><span class="fl">27.778990</span>

prob &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pt</span>(<span class="kw">abs</span>(test_statistic),df)

p_value &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>prob</code></pre></div>
<p>The p-value is _______. Given there is no linear relationship between <code>PercentAlcohol</code> and <code>CaloriesPer12Oz</code>, the probability of obtaining a test statistic with magnitude ________ or more extreme is _______.</p>
<p><strong>7. Fill in the code below to calculate the predicted calories and corresponding 90% interval for a single beer with alcohol content of 4.3%.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x0 &lt;-<span class="st">  </span><span class="kw">data.frame</span>(<span class="dt">PercentAlcohol=</span><span class="fl">4.3</span>)
<span class="kw">predict.lm</span>(model,x0,<span class="dt">interval=</span><span class="st">&quot;prediction&quot;</span>,<span class="dt">conf.level=</span><span class="fl">0.9</span>) </code></pre></div>
<p><strong>8. Fill in the code below to calculate the predicted calories and corresponding 90% interval for the subset of beers with alcohol content of 4.3%.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x0 &lt;-<span class="st">  </span><span class="kw">data.frame</span>(<span class="dt">PercentAlcohol=</span><span class="fl">4.3</span>)
<span class="kw">predict.lm</span>(model,x0,<span class="dt">interval=</span><span class="st">&quot;confidence&quot;</span>,<span class="dt">conf.level=</span> <span class="fl">0.9</span>) </code></pre></div>

</div>
<div id="analyzing-wages" class="section level2">
<h2><span class="header-section-number">10.30</span> Analyzing Wages</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(knitr)
<span class="kw">library</span>(broom)
<span class="kw">library</span>(Sleuth3)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages &lt;-<span class="st"> </span>case1202 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Female =</span> <span class="kw">ifelse</span>(Sex<span class="op">==</span><span class="st">&quot;Female&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Sal77,<span class="op">-</span>Sex)</code></pre></div>
<div id="initial-model" class="section level3">
<h3><span class="header-section-number">10.30.1</span> Initial model</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model &lt;-<span class="st"> </span><span class="kw">lm</span>(Bsal <span class="op">~</span><span class="st"> </span>Senior <span class="op">+</span><span class="st"> </span>Age <span class="op">+</span><span class="st"> </span>Educ <span class="op">+</span><span class="st"> </span>Exper <span class="op">+</span><span class="st"> </span>Female, 
            <span class="dt">data=</span>wages)
<span class="kw">tidy</span>(model,<span class="dt">conf.int=</span><span class="ot">TRUE</span>)</code></pre></div>
</div>
<div id="model-with-mean-centered-variables" class="section level3">
<h3><span class="header-section-number">10.30.2</span> Model with mean-centered variables</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages &lt;-<span class="st"> </span>wages <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">SeniorCent =</span> Senior <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(Senior), 
         <span class="dt">AgeCent =</span> Age<span class="op">-</span><span class="kw">mean</span>(Age), 
         <span class="dt">EducCent =</span> Educ <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(Educ), 
         <span class="dt">ExperCent =</span> Exper <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(Exper))</code></pre></div>
<ul>
<li><p>Calculate the regression model using the mean-centered variables.</p></li>
<li><p>How did the model change?</p></li>
</ul>
</div>
<div id="model-with-indicator-variables" class="section level3">
<h3><span class="header-section-number">10.30.3</span> Model with indicator variables</h3>
<ul>
<li>Use the code below to create a categorical variable for <code>Educ</code>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wages &lt;-<span class="st"> </span>wages <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">EducCat =</span> <span class="kw">as.factor</span>(Educ))</code></pre></div>
<ul>
<li>Calculate the regression model using <code>EducCat</code> instead of <code>Educ</code>.</li>
</ul>

</div>
</div>
<div id="exam-01-review" class="section level2">
<h2><span class="header-section-number">10.31</span> Exam 01 Review</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(broom)
<span class="kw">library</span>(rms)
<span class="kw">library</span>(knitr)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">12</span>)
diamonds_samp &lt;-<span class="st"> </span>ggplot2<span class="op">::</span>diamonds <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(carat <span class="op">&lt;</span><span class="st"> </span><span class="fl">1.1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">300</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">log_price =</span> <span class="kw">log</span>(price), 
         <span class="dt">caratCent =</span> carat <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(carat), 
         <span class="dt">caratCent_sq =</span> caratCent<span class="op">^</span><span class="dv">2</span>, 
        <span class="dt">color =</span> <span class="kw">factor</span>(<span class="kw">as.character</span>(color)), <span class="co"># to fix variable format in model output</span>
        <span class="dt">clarity =</span> <span class="kw">factor</span>(<span class="kw">as.character</span>(clarity)) <span class="co"># to fix variable format in model output</span>
)</code></pre></div>
<div id="main-effects-model" class="section level3">
<h3><span class="header-section-number">10.31.1</span> Main Effects Model</h3>
<ul>
<li><strong>Why should we use <code>logprice</code> instead of <code>price</code> as the response variable? In other words, what is an example of previous analysis that could have been done to help us determine whether to use <code>logprice</code> or <code>price</code>?</strong></li>
</ul>
<p>To determine if a transformation on the response variable is needed, we can examine the following:</p>
<ul>
<li>The distribution of the response variable to see if there is extreme skewness</li>
<li>The plot of the residuals vs. predicted to check for non-constant variance</li>
<li>The histogram and QQ-plot of the residuals to see if there is extreme skewness in the residuals</li>
</ul>
<p>Below is the model with <code>log_price</code> as the response and <code>caratCent</code>, <code>color</code>, and <code>clarity</code> as the predictor variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model_orig &lt;-<span class="st"> </span><span class="kw">lm</span>(log_price <span class="op">~</span><span class="st"> </span>caratCent <span class="op">+</span><span class="st">  </span>color <span class="op">+</span><span class="st"> </span>clarity, <span class="dt">data=</span>diamonds_samp)
<span class="kw">kable</span>(<span class="kw">tidy</span>(model_orig),<span class="dt">format=</span><span class="st">&quot;markdown&quot;</span>)</code></pre></div>
<ul>
<li><strong>What is the baseline level of <code>color</code>? What is the baseline level of <code>clarity</code>?</strong></li>
</ul>
<p>The baseline level of <code>color</code> is <code>D</code>. The baseline level of <code>clarity</code> is <code>I1</code>.</p>
<ul>
<li><strong>Interpret the intercept in terms of <code>price</code>.</strong></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">coef &lt;-<span class="st">  </span>model_orig<span class="op">$</span>coefficients</code></pre></div>
<p>We expect the median price of diamonds with color D, clarity I1, and the mean carat weight (_____) to be approximately exp(______) = ______.</p>
<ul>
<li><strong>Describe the difference in the typical prices of diamonds that are color E and diamonds that are color D, holding all else constant.</strong></li>
</ul>
<p>The difference in terms of the log(price) is the coefficient of <code>colorE</code>, _______. Therefore, the difference in terms of the price is</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(diff_e_d &lt;-<span class="st"> </span><span class="kw">exp</span>(coef[<span class="dv">3</span>]))</code></pre></div>
<p>Therefore, holding all else constant, diamonds that are color E are expected to have a median price that is ______ times the median price of diamonds that are color D.</p>
<ul>
<li><strong>Describe the difference in the typical prices of diamonds that are color E and diamonds that are color G, holding all else constant.</strong></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(diff_e_g_log &lt;-<span class="st"> </span>coef[<span class="dv">3</span>] <span class="op">-</span><span class="st"> </span>coef[<span class="dv">5</span>])</code></pre></div>
<p>Therefore, the difference in terms of the price is</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(diff_e_g &lt;-<span class="st"> </span><span class="kw">exp</span>(diff_e_g_log))</code></pre></div>
<p>Therefore, holding all else constant, diamonds that are color E are expected to have a median price that is ______ times the median price of diamonds that are color G.</p>
<ul>
<li><strong>What is the predicted price of a single diamond that has color E, clarity VS2 and is 0.3 carats? Finish the code below the predicted value and the corresponding interval.</strong></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x0 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">color=</span><span class="st">&quot;E&quot;</span>, <span class="dt">clarity=</span><span class="st">&quot;VS2&quot;</span>, <span class="dt">carat=</span><span class="fl">0.3</span>)
x0 &lt;-<span class="st"> </span>x0 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(
  <span class="dt">caratCent =</span> carat <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(diamonds_samp<span class="op">$</span>carat),
  <span class="dt">caratCent_sq =</span> caratCent<span class="op">^</span><span class="dv">2</span>
)

(<span class="kw">exp</span>(<span class="kw">predict</span>(model_orig,x0,<span class="dt">interval=</span><span class="st">&quot;prediction&quot;</span>))) <span class="co">#interval to predict for single observation</span></code></pre></div>
<ul>
<li><p><strong>Suppose we wish to find the predicted median price of subset of all diamonds with color E, clarity VS2, and 0.3 carats. How do you expect the predicted price to change? How do you expect the corresponding interval to change?</strong></p>
<ul>
<li>The predicted price won’t change, but the interval will be more narrow.</li>
</ul></li>
<li><p><strong>Write code to find the predicted price and corresponding interval for the median price for the subset of all diamonds with color E, clarity VS2 and 0.3 carats.</strong></p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="kw">exp</span>(<span class="kw">predict</span>(model_orig,x0,<span class="dt">interval=</span><span class="st">&quot;confidence&quot;</span>))) <span class="co">#interval to predict typical price for subset</span></code></pre></div>
<p><br><br></p>
<p>Use the code below to obtain the ANOVA table for this model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anova</span>(model_orig)</code></pre></div>
<ul>
<li><strong>What is the estimated regression variance?</strong></li>
</ul>
<p>The estimated regression variance is the Residual Mean Square, 0.0204.</p>
<ul>
<li><strong>Compare <span class="math inline">\(R^2\)</span> and <span class="math inline">\(Adj. R^2\)</span>. What does this comparison tell you about the predictors in the model?</strong></li>
</ul>
<p><span class="math inline">\(R^2\)</span> is ______ and Adjusted <span class="math inline">\(R^2\)</span> is ______. These values are very close, indicating that the predictors in the model are important for understanding variation in price. There aren’t a lot of predictors in the model that aren’t significant.</p>
<ul>
<li>Use the code below to calculate the VIF for this model.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">vif</span>(model_orig)</code></pre></div>
<ul>
<li><strong>This model has potential problems with multicollinearity. How did we come to this conclusion? Which variables are highly collinear?</strong></li>
</ul>
<p>We know this model has potential problems with multicollinearity, because there are multiple predictors with VIFs close or above 10. The variables with high collinearity are the indicator variables for <code>clarity</code>.</p>
<ul>
<li><strong>Why do you think this multicollinearity is occurring? <em>Hint: Examine the distribution of the variable(s) that have high multicollinearity.</em></strong></li>
</ul>
<p>Let’s look at the distribution of <code>clarity</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds_samp <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>(clarity)</code></pre></div>
<p>The baseline level is <code>I1</code>, and there are only 2 observations out of ______ with this level for clarity. Because there are so few observations at the baseline level, it is almost as if we have no baseline level for the categorical predictor <code>clarity</code> in the model. Remember, if we have no baseline level for a categorical variable in the model and there is an intercept, then the indicator variables are just linear combinations for one another. In this case, the indicator variables aren’t exact linear combinations of one another, but they are highly collinear.</p>
<p>This multicollinearity is reduced when the baseline level is changed to a different level of <code>clarity</code>. Below is the VIF for a model with <code>IF</code>, the highest level of clarity as the baseline.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">diamonds_samp <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">clarity =</span> <span class="kw">fct_rev</span>(clarity)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#reverse the factoring order of clarity</span>
<span class="st">  </span><span class="kw">lm</span>(log_price <span class="op">~</span><span class="st"> </span>caratCent <span class="op">+</span><span class="st">  </span>color <span class="op">+</span><span class="st"> </span>clarity, <span class="dt">data=</span>.) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">vif</span>()</code></pre></div>
</div>
</div>
<div id="model-with-interactions" class="section level2">
<h2><span class="header-section-number">10.32</span> Model with Interactions</h2>
<ul>
<li><p>Below is the model that includes an interaction term between <code>caratCent</code> and <code>color</code>. What is the appropriate method to determine if the interaction is significant?</p></li>
<li><p>We should use the nested F test.</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model_int &lt;-<span class="st"> </span><span class="kw">lm</span>(log_price <span class="op">~</span><span class="st"> </span>caratCent <span class="op">+</span><span class="st"> </span>color <span class="op">+</span><span class="st"> </span>
<span class="st">                  </span>clarity <span class="op">+</span><span class="st"> </span>caratCent<span class="op">*</span>color, <span class="dt">data=</span>diamonds_samp)</code></pre></div>
<ul>
<li>Conduct the test you listed above. What is your conclusion?</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anova</span>(model_orig, model_int)</code></pre></div>
<p>The p-value is 0.4104, indicating that there is not sufficient evidence that the interaction between carat and color is significant.</p>
<p><em>Regardless of your answer to the previous question, use <code>model_int</code> to answer the next two questions:</em></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">kable</span>(<span class="kw">tidy</span>(model_int),<span class="dt">format=</span><span class="st">&quot;markdown&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">coef_int &lt;-<span class="st"> </span>model_int<span class="op">$</span>coefficients</code></pre></div>
<ul>
<li><p><strong>What is the estimated slope of <code>caratCent</code> for a diamond with <code>color==D</code>?</strong></p></li>
<li><p><strong>What is the estimated slope of <code>caratCent</code> for a diamond with <code>color==J</code>?</strong></p></li>
</ul>

</div>
<div id="model-selection-1" class="section level2">
<h2><span class="header-section-number">10.33</span> Model Selection</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(knitr)
<span class="kw">library</span>(broom)
<span class="kw">library</span>(Sleuth3)
<span class="kw">library</span>(leaps)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sat_scores &lt;-<span class="st"> </span>case1201 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>State) <span class="co">#remove the state variable</span></code></pre></div>
</div>
<div id="backward-selection-manually" class="section level2">
<h2><span class="header-section-number">10.34</span> Backward selection “manually”</h2>
<ul>
<li>Manually perform backward selection using Adj. <span class="math inline">\(R^2\)</span> as the selection criteria. Show each step of the selection process. To help you get started, the full model and the code for the first set of models to test are below. You will need to find Adj. <span class="math inline">\(R^2\)</span> for each model.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">full_model &lt;-<span class="st"> </span><span class="kw">lm</span>(SAT <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> sat_scores)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m1 &lt;-<span class="st"> </span><span class="kw">lm</span>(SAT <span class="op">~</span><span class="st"> </span>Income <span class="op">+</span><span class="st"> </span>Years <span class="op">+</span><span class="st"> </span>Public <span class="op">+</span><span class="st"> </span>Expend <span class="op">+</span><span class="st"> </span>Rank, <span class="dt">data =</span> sat_scores)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m2 &lt;-<span class="st"> </span><span class="kw">lm</span>(SAT <span class="op">~</span><span class="st"> </span>Takers <span class="op">+</span><span class="st"> </span>Years <span class="op">+</span><span class="st"> </span>Public <span class="op">+</span><span class="st"> </span>Expend <span class="op">+</span><span class="st"> </span>Rank, <span class="dt">data =</span> sat_scores)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m3 &lt;-<span class="st"> </span><span class="kw">lm</span>(SAT <span class="op">~</span><span class="st"> </span>Takers <span class="op">+</span><span class="st"> </span>Income <span class="op">+</span><span class="st"> </span>Public <span class="op">+</span><span class="st"> </span>Expend <span class="op">+</span><span class="st"> </span>Rank, <span class="dt">data =</span> sat_scores)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m4 &lt;-<span class="st"> </span><span class="kw">lm</span>(SAT <span class="op">~</span><span class="st"> </span>Takers <span class="op">+</span><span class="st"> </span>Years <span class="op">+</span><span class="st"> </span>Income <span class="op">+</span><span class="st"> </span>Expend <span class="op">+</span><span class="st"> </span>Rank, <span class="dt">data =</span> sat_scores)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m5 &lt;-<span class="st"> </span><span class="kw">lm</span>(SAT <span class="op">~</span><span class="st"> </span>Takers <span class="op">+</span><span class="st"> </span>Years <span class="op">+</span><span class="st"> </span>Public <span class="op">+</span><span class="st"> </span>Income <span class="op">+</span><span class="st"> </span>Expend, <span class="dt">data =</span> sat_scores)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m6 &lt;-<span class="st"> </span><span class="kw">lm</span>(SAT <span class="op">~</span><span class="st"> </span>Takers <span class="op">+</span><span class="st"> </span>Years <span class="op">+</span><span class="st"> </span>Public <span class="op">+</span><span class="st"> </span>Income <span class="op">+</span><span class="st"> </span>Rank, <span class="dt">data =</span> sat_scores)</code></pre></div>
<p>Continue the model selection until you have a final model. Show each step of the model selection process.</p>
</div>
<div id="backward-selection-using-regsubsets" class="section level2">
<h2><span class="header-section-number">10.35</span> Backward selection using regsubsets</h2>
<ul>
<li>Use the <code>regsubsets</code> function to perform backward selection using Adj. <span class="math inline">\(R^2\)</span> as the selection criteria. Are the variables the same as the ones at you chose? Is the Adj. <span class="math inline">\(R^2\)</span> the same?</li>
</ul>
</div>
<div id="changing-selection-criteria" class="section level2">
<h2><span class="header-section-number">10.36</span> Changing selection criteria</h2>
<ul>
<li><p>Use the <code>regsubsets</code> function to perform backward selection using BIC as the selection criteria. What variables were chosen for the follow model? How does this model compare to the one selected using Adj. <span class="math inline">\(R^2\)</span>?</p></li>
<li><p>Use the <code>step</code> function to perform backward selection using AIC as the selection criteria. What variables were chosen for the follow model? How does this model compare to the models chosen from the other selection criteria?</p></li>
</ul>
</div>
<div id="different-selection-procedure" class="section level2">
<h2><span class="header-section-number">10.37</span> Different selection procedure</h2>
<ul>
<li><p>Use forward or stepwise selection to choose a model. Choose the criteria you will use to select the model.</p></li>
<li><p>How does this model compare to the previous selected models?</p></li>
</ul>
</div>
<div id="choosing-a-final-model" class="section level2">
<h2><span class="header-section-number">10.38</span> Choosing a final model</h2>
<ul>
<li>You likely have at least 2 different models chosen by the various model selection procedures. Which variables will you include in your final model? Why did you choose this to be your final model?</li>
</ul>

</div>
<div id="logistic-regression-1" class="section level2">
<h2><span class="header-section-number">10.39</span> Logistic Regression</h2>
<p>The goal of this exercise is to walk through a logistic regression analysis. It will give you a basic idea of the analysis steps and thought-process; however, due to class time constraints, this analysis is not exhaustive.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(broom)
<span class="kw">library</span>(rms)
## add any other packages as needed </code></pre></div>
<p>This data is from an ongoing cardiovascular study on residents of the town of Framingham, Massachusetts. The goal is to predict whether a patient has a 10-year risk of future coronary heart disease. The dataset includes the following:</p>
<ul>
<li><code>male</code>: 0 = Female; 1 = Male</li>
<li><code>age</code>: Age at exam time.</li>
<li><code>education</code>: 1 = Some High School; 2 = High School or GED; 3 = Some College or Vocational School; 4 = College</li>
<li><code>currentSmoker</code>: 0 = nonsmoker; 1 = smoker</li>
<li><code>cigsPerDay</code>: number of cigarettes smoked per day (estimated average)</li>
<li><code>BPMeds</code>: 0 = Not on Blood Pressure medications; 1 = Is on Blood Pressure medications</li>
<li><code>prevalentStroke</code></li>
<li><code>prevalentHyp</code></li>
<li><code>diabetes</code>: 0 = No; 1 = Yes</li>
<li><code>totChol</code>: total cholesterol (mg/dL)</li>
<li><code>sysBP</code>: systolic blood pressure (mmHg)</li>
<li><code>diaBP</code>: diastolic blood pressure (mmHg)</li>
<li><code>BMI</code>: BodyMass Index calculated as: Weight (kg) / Height(meter-squared)</li>
<li><code>heartRate</code> Beats/Min (Ventricular)</li>
<li><code>glucose</code>: total glucose mg/dL</li>
<li><code>TenYearCHD</code>: 0 = Patient doesn’t have 10-year risk of future coronary heart disease; 1 = Patient has 10-year risk of future coronary heart disease;</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fram_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/framingham.csv&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">drop_na</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">education =</span> <span class="kw">case_when</span>(
    education <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> &quot;Some HS&quot;</span>, 
    education <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">~</span><span class="st"> &quot;HS or GED&quot;</span>, 
    education <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">~</span><span class="st"> &quot;Some College&quot;</span>, 
    education <span class="op">==</span><span class="st"> </span><span class="dv">4</span> <span class="op">~</span><span class="st"> &quot;College&quot;</span>
  ),
  <span class="dt">currentSmoker =</span> <span class="kw">if_else</span>(currentSmoker <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;nonsmoker&quot;</span>, <span class="st">&quot;smoker&quot;</span>),
  <span class="dt">diabetes =</span> <span class="kw">if_else</span>(diabetes <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,<span class="st">&quot;No&quot;</span>, <span class="st">&quot;Yes&quot;</span>),
  <span class="dt">male =</span> <span class="kw">factor</span>(male)
  )</code></pre></div>
<ul>
<li><p>Fit a full model (main effects only) with <code>TenYearCHD</code> as the response. Display the model output.</p></li>
<li><p>Based on the goal of the analysis, should the full model be the final model? Why or why not?</p></li>
<li>Use the <code>step</code> function to conduct backward model selection. What is selection criteria used by the <code>step</code> function?
<ul>
<li>Display the final model.</li>
</ul></li>
<li>There is reason to believe that the factors related to coronary heart disease may have different effects for men and women. We would like to include this information in the model. Use the drop-in-deviance test to test at least three interactions with <code>male</code>.
<ul>
<li>Which interactions did you choose? Why?</li>
<li>Include the output from the tests.</li>
</ul></li>
<li><p>Use the results from model selection and the drop-in-deviance test to select a final model. Display the model below.</p></li>
<li><p>Plot and analyze the binned residuals for the final model. Include all appropriate plots. What is your assessment on the model fit based on these plots?</p></li>
<li><p>Plot and analyze the ROC curve. Based on the ROC curve, does the model fit the data well?</p></li>
<li><p>A doctor plans to use the results from your model to help select patients for a new heart disease prevention program. She asks you which threshold would be best to select patients for this program. What threshold would you recommend to the doctor? Why?</p></li>
</ul>
</div>
<div id="references-1" class="section level2">
<h2><span class="header-section-number">10.40</span> References</h2>
<ul>
<li>Data obtained from <a href="https://www.kaggle.com/neisha/heart-disease-prediction-using-logistic-regression/data" class="uri">https://www.kaggle.com/neisha/heart-disease-prediction-using-logistic-regression/data</a></li>
</ul>

</div>
<div id="multinomial-logistic-regression-1" class="section level2">
<h2><span class="header-section-number">10.41</span> Multinomial Logistic Regression</h2>
<p>The main objective of this analysis is to understand how encouragement affects the frequency that children watch <em>Sesame Street</em>. We will use the following variables:</p>
<p><strong>Response:</strong></p>
<ul>
<li><font class="vocab"><code>viewcat</code></font>
<ul>
<li>1: rarely watched show</li>
<li>2: once or twice a week</li>
<li>3: three to five times a week</li>
<li>4: watched show on average more than five times a week</li>
</ul></li>
</ul>
<p><strong>Predictors:</strong></p>
<ul>
<li><font class="vocab"><code>age</code>:</font> child’s age in months</li>
<li><font class="vocab"><code>prenumb</code>: </font>score on numbers pretest (0 to 54)</li>
<li><font class="vocab"><code>prelet</code>: </font>score on letters pretest (0 to 58)</li>
<li><font class="vocab"><code>viewenc</code>:</font> 1: encouraged to watch, 2: not encouraged</li>
<li><font class="vocab"><code>site:</code></font>
<ul>
<li>1: three to five year old from disadvantaged inner city area</li>
<li>2: four year old from advantaged suburban area</li>
<li>3: from advantaged rural area</li>
<li>4: from disadvantaged rural area</li>
<li>5: from Spanish speaking home</li>
</ul></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># read in dataset</span>
sesame &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/sesame.csv&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># mean-center relevant continuous variables, make categorical variables factors</span>
sesame &lt;-<span class="st"> </span>sesame <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">viewcat =</span> <span class="kw">as.factor</span>(viewcat), 
         <span class="dt">site =</span> <span class="kw">as.factor</span>(site), 
         <span class="dt">prenumbCent =</span> prenumb <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(prenumb), 
         <span class="dt">preletCent =</span> prelet <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(prelet), 
         <span class="dt">ageCent =</span> age <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(age),
         <span class="dt">viewenc =</span> <span class="kw">ifelse</span>(viewenc <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot;Encouraged&quot;</span>, <span class="st">&quot;Not Encouraged&quot;</span>))</code></pre></div>
<p><br></p>
<div id="questions" class="section level3">
<h3><span class="header-section-number">10.41.1</span> Questions</h3>
<ol style="list-style-type: decimal">
<li><p>We will build a model to predict how often a child in this study watched <em>Sesame Street</em>. What type of model should we build? Why?</p></li>
<li><p>Describe how you would conduct exploratory data analysis. What plots and/or summary statistics would you include? What information would you learn from the exploratory data analysis?</p></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model1 &lt;-<span class="st"> </span><span class="kw">multinom</span>(viewcat <span class="op">~</span><span class="st"> </span>site <span class="op">+</span><span class="st"> </span>viewenc <span class="op">+</span><span class="st"> </span>prenumbCent <span class="op">+</span><span class="st"> </span>preletCent <span class="op">+</span><span class="st"> </span>ageCent,
                   <span class="dt">data =</span> sesame)
<span class="kw">kable</span>(<span class="kw">tidy</span>(model1, <span class="dt">conf.int=</span><span class="ot">TRUE</span>, <span class="dt">exponentiate =</span> <span class="ot">FALSE</span>),
      <span class="dt">format =</span> <span class="st">&quot;markdown&quot;</span>)</code></pre></div>
<p><br></p>
<ol start="3" style="list-style-type: decimal">
<li><p>Interpret the intercept associated with the odds of <code>viewcat == 2</code> versus <code>viewcat == 1</code>.</p></li>
<li><p>Interpret the effect of the numbers pretest score on the odds of viewership.</p></li>
<li><p>The primary objective of the experiment was to understand the effect of encouragement <code>viewenc</code> on viewership. Does encouragement have a significant effect on viewership? If so, describe the effect. Otherwise, explain why not.</p></li>
<li><p>We want to test if there are any significant interactions with <code>viewenc</code> and the pretests. We create a model that includes the variables from <code>model1</code> along with <code>viewenc*preletCent</code> and <code>viewenc*prenumbCent</code>.</p></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model2 &lt;-<span class="st"> </span><span class="kw">multinom</span>(viewcat <span class="op">~</span><span class="st"> </span>site <span class="op">+</span><span class="st"> </span>viewenc <span class="op">+</span><span class="st"> </span>prenumbCent <span class="op">+</span><span class="st"> </span>preletCent <span class="op">+</span><span class="st"> </span>ageCent <span class="op">+</span><span class="st"> </span>
<span class="st">                     </span>viewenc<span class="op">*</span>preletCent <span class="op">+</span><span class="st"> </span>viewenc<span class="op">*</span>prenumbCent,
                   <span class="dt">data =</span> sesame)</code></pre></div>
<p>The results from the drop-in-deviance test are shown below. Is there evidence of a significant interaction effect? Explain.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">anova</span>(model1, model2, <span class="dt">test =</span> <span class="st">&quot;Chisq&quot;</span>)</code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li>How would you assess the appropriateness of the model flit? Describe the plots, tables, and/or calculations you would create to assess model fit.</li>
</ol>
</div>
<div id="references-2" class="section level3">
<h3><span class="header-section-number">10.41.2</span> References</h3>
<p>Data from <a href="http://www2.stat.duke.edu/~jerry/sta210/sesamelab.html" class="uri">http://www2.stat.duke.edu/~jerry/sta210/sesamelab.html</a></p>

</div>
</div>
<div id="dealing-with-missing-data" class="section level2">
<h2><span class="header-section-number">10.42</span> Dealing with Missing Data</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(knitr)
<span class="kw">library</span>(broom)
<span class="kw">library</span>(skimr)
<span class="kw">library</span>(nnet)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nhanes &lt;-<span class="st"> </span>mice<span class="op">::</span>nhanes2
nhanes</code></pre></div>
<ol style="list-style-type: decimal">
<li>Explore missingness</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(nnet)
m &lt;-<span class="st"> </span><span class="kw">multinom</span>(age <span class="op">~</span><span class="st"> </span>bmi <span class="op">+</span><span class="st"> </span>hyp <span class="op">+</span><span class="st"> </span>chl, <span class="dt">data =</span> mice<span class="op">::</span>nhanes2)
knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">tidy</span>(m, <span class="dt">conf.int =</span> T),<span class="dt">format =</span> <span class="st">&quot;markdown&quot;</span>)</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Complete-case analyis</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">complete &lt;-<span class="st"> </span>nhanes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>()
m &lt;-<span class="st"> </span><span class="kw">multinom</span>(age <span class="op">~</span><span class="st"> </span>bmi <span class="op">+</span><span class="st"> </span>hyp <span class="op">+</span><span class="st"> </span>chl, <span class="dt">data =</span> complete)
knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">tidy</span>(m, <span class="dt">conf.int =</span> T),<span class="dt">format =</span> <span class="st">&quot;markdown&quot;</span>)</code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><p>Single imputation</p></li>
<li><p>Indicator variables</p></li>
</ol>

</div>
<div id="matrix-form-of-linear-regression" class="section level2">
<h2><span class="header-section-number">10.43</span> Matrix Form of Linear Regression</h2>
<p>This document provides the details for the matrix form of multiple linear regression. We assume the reader has familiarity with some matrix alegbra. Please see Chapter 1 of <a href="https://www-bcf.usc.edu/~gareth/ISL/"><em>An Introduction to Statistical Learning</em></a> for a brief review of matrix algebra.</p>
</div>
<div id="introduction-1" class="section level2">
<h2><span class="header-section-number">10.44</span> Introduction</h2>
<p>Suppose we have <span class="math inline">\(n\)</span> observations. Let the <span class="math inline">\(i^{th}\)</span> be <span class="math inline">\((x_{i1}, \ldots, x_{ip}, y_i)\)</span>, such that <span class="math inline">\(x_{i1}, \ldots, x_{ip}\)</span> are the explanatory variables (predictors) and <span class="math inline">\(y_i\)</span> is the response variable. We assume the data can be modeled using the least-squares regression model, such that the mean response for a given combination of explanatory variables follows the form in ().</p>
<span class="math display">\[\begin{equation}
\label{basic_model}
y = \beta_0 + \beta_1 x_1 + \dots + \beta_p x_p 
\end{equation}\]</span>
<p>We can write the response for the <span class="math inline">\(i^{th}\)</span> observation as shown in ()</p>
<span class="math display">\[\begin{equation}
\label{ind_response}
y_i = \beta_0 + \beta_1 x_{i1} + \dots + \beta_p x_{ip} + \epsilon_i 
\end{equation}\]</span>
<p>such that <span class="math inline">\(\epsilon_i\)</span> is the amount <span class="math inline">\(y_i\)</span> deviates from <span class="math inline">\(\mu\{y|x_{i1}, \ldots, x_{ip}\}\)</span>, the mean response for a given combination of explanatory variables. We assume each <span class="math inline">\(\epsilon_i \sim N(0,\sigma^2)\)</span>, where <span class="math inline">\(\sigma^2\)</span> is a constant variance for the distribution of the response <span class="math inline">\(y\)</span> for any combination of explanatory variables <span class="math inline">\(x_1, \ldots, x_p\)</span>.</p>
</div>
<div id="matrix-form-for-the-regression-model" class="section level2">
<h2><span class="header-section-number">10.45</span> Matrix Form for the Regression Model</h2>
<p>We can represent the () and () using matrix notation. Let</p>
<span class="math display">\[\begin{equation}
\label{matrix notation}
\mathbf{Y} = \begin{bmatrix}y_1 \\ y_2 \\ \vdots \\y_n\end{bmatrix} 
\hspace{15mm}
\mathbf{X} = \begin{bmatrix}x_{11} &amp; x_{12} &amp; \dots &amp; x_{1p} \\
x_{21} &amp; x_{22} &amp; \dots &amp; x_{2p} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots\\
x_{n1} &amp; x_{n2} &amp; \dots &amp; x_{np} \end{bmatrix}
\hspace{15mm}
\boldsymbol{\beta}= \begin{bmatrix}\beta_0 \\ \beta_1 \\ \vdots \\ \beta_p \end{bmatrix} 
\hspace{15mm}
\boldsymbol{\epsilon}= \begin{bmatrix}\epsilon_1 \\ \epsilon_2 \\ \vdots \\ \epsilon_n \end{bmatrix}
\end{equation}\]</span>
<p>Thus,</p>
<p><span class="math display">\[\mathbf{Y} = \mathbf{X}\boldsymbol{\beta} + \mathbf{\epsilon}\]</span></p>
<p>Therefore the estimated response for a given combination of explanatory variables and the associated residuals can be written as</p>
<span class="math display">\[\begin{equation}
\label{matrix_mean}
\hat{\mathbf{Y}} = \mathbf{X}\hat{\boldsymbol{\beta}} \hspace{10mm} \mathbf{e} = \mathbf{Y} - \mathbf{X}\hat{\boldsymbol{\beta}}
\end{equation}\]</span>
</div>
<div id="estimating-the-coefficients" class="section level2">
<h2><span class="header-section-number">10.46</span> Estimating the Coefficients</h2>
<p>The least-squares model is the one that minimizes the sum of the squared residuals. Therefore, we want to find the coefficients, <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span> that minimizes</p>
<span class="math display">\[\begin{equation}
\label{sum_sq_resid}
\sum\limits_{i=1}^{n} e_{i}^2 = \mathbf{e}^T\mathbf{e} = (\mathbf{Y} - \mathbf{X}\hat{\boldsymbol{\beta}})^T(\mathbf{Y} - \mathbf{X}\hat{\boldsymbol{\beta}})
\end{equation}\]</span>
<p>where <span class="math inline">\(\mathbf{e}^T\)</span>, the transpose of the matrix <span class="math inline">\(\mathbf{e}\)</span>.</p>
<span class="math display">\[\begin{equation}
\label{model_equation}
(\mathbf{Y} - \mathbf{X}\hat{\boldsymbol{\beta}})^T(\mathbf{Y} - \mathbf{X}\hat{\boldsymbol{\beta}}) = (\mathbf{Y}^T\mathbf{Y} - 
\mathbf{Y}^T \mathbf{X}\hat{\boldsymbol{\beta}} - (\hat{\boldsymbol{\beta}}{}^{T}\mathbf{X}^T\mathbf{Y} +
\hat{\boldsymbol{\beta}}{}^{T}\mathbf{X}^T\mathbf{X}
\hat{\boldsymbol{\beta}})
\end{equation}\]</span>
<p>Note that <span class="math inline">\((\mathbf{Y^T}\mathbf{X}\hat{\boldsymbol{\beta}})^T = \hat{\boldsymbol{\beta}}{}^{T}\mathbf{X}^T\mathbf{Y}\)</span>. Since these are both constants (i.e. <span class="math inline">\(1\times 1\)</span> vectors), <span class="math inline">\(\mathbf{Y^T}\mathbf{X}\hat{\boldsymbol{\beta}} = \hat{\boldsymbol{\beta}}{}^{T}\mathbf{X}^T\mathbf{Y}\)</span>. Thus, () becomes</p>
<span class="math display">\[\begin{equation}
\mathbf{Y}^T\mathbf{Y} - 2 \mathbf{X}^T\hat{\boldsymbol{\beta}}{}^{T}\mathbf{Y} + \hat{\boldsymbol{\beta}}{}^{T}\mathbf{X}^T\mathbf{X}
\hat{\boldsymbol{\beta}}
\end{equation}\]</span>
<p>Since we want to find the <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span> that minimizes (), will find the value of <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span> such that the derivative with respect to <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span> is equal to 0.</p>
<span class="math display">\[\begin{equation}
\begin{aligned}
\frac{\partial \mathbf{e}^T\mathbf{e}}{\partial \hat{\boldsymbol{\beta}}} &amp; = \frac{\partial}{\partial \hat{\boldsymbol{\beta}}}(\mathbf{Y}^T\mathbf{Y} - 2 \mathbf{X}^T\hat{\boldsymbol{\beta}}{}^T\mathbf{Y} + \hat{\boldsymbol{\beta}}{}^{T}\mathbf{X}^T\mathbf{X}\hat{\boldsymbol{\beta}}) = 0 \\[10pt]
&amp;\Rightarrow - 2 \mathbf{X}^T\mathbf{Y} + 2 \mathbf{X}^T\mathbf{X}\hat{\boldsymbol{\beta}} = 0 \\[10pt]
&amp; \Rightarrow 2 \mathbf{X}^T\mathbf{Y} = 2 \mathbf{X}^T\mathbf{X}\hat{\boldsymbol{\beta}} \\[10pt]
&amp; \Rightarrow \mathbf{X}^T\mathbf{Y} = \mathbf{X}^T\mathbf{X}\hat{\boldsymbol{\beta}} \\[10pt]
&amp; \Rightarrow (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{Y} = (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{X}\hat{\boldsymbol{\beta}} \\[10pt]
&amp; \Rightarrow (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{Y} = \mathbf{I}\hat{\boldsymbol{\beta}}
\end{aligned}
\end{equation}\]</span>
<p>Thus, the estimate of the model coefficients is <span class="math inline">\(\hat{\boldsymbol{\beta}} = (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{Y}\)</span>.</p>
</div>
<div id="variance-covariance-matrix-of-the-coefficients" class="section level2">
<h2><span class="header-section-number">10.47</span> Variance-covariance matrix of the coefficients</h2>
<p>We will use two properties to derive the form of the variance-covarinace matrix of the coefficients:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(E[\boldsymbol{\epsilon}\boldsymbol{\epsilon}^T] = \sigma^2I\)</span></li>
<li><span class="math inline">\(\hat{\boldsymbol{\beta}} = \boldsymbol{\beta} + (\mathbf{X}^T\mathbf{X})^{-1}\epsilon\)</span></li>
</ol>
First, we will show that <span class="math inline">\(E[\boldsymbol{\epsilon}\boldsymbol{\epsilon}^T] = \sigma^2I\)</span>
<span class="math display">\[\begin{equation}
\label{expected_error}
\begin{aligned}
E[\boldsymbol{\epsilon}\boldsymbol{\epsilon}^T] &amp;= E \begin{bmatrix}\epsilon_1  &amp; \epsilon_2 &amp; \dots &amp; \epsilon_n \end{bmatrix}\begin{bmatrix}\epsilon_1 \\ \epsilon_2 \\ \vdots \\ \epsilon_n \end{bmatrix}  \\[10pt]
&amp; = E \begin{bmatrix} \epsilon_1^2  &amp; \epsilon_1 \epsilon_2 &amp; \dots &amp; \epsilon_1 \epsilon_n \\
\epsilon_2 \epsilon_1 &amp; \epsilon_2^2 &amp; \dots &amp; \epsilon_2 \epsilon_n \\ 
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\ 
\epsilon_n \epsilon_1 &amp; \epsilon_n \epsilon_2 &amp; \dots &amp; \epsilon_n^2 
\end{bmatrix} \\[10pt]
&amp; = \begin{bmatrix} E[\epsilon_1^2]  &amp; E[\epsilon_1 \epsilon_2] &amp; \dots &amp; E[\epsilon_1 \epsilon_n] \\
E[\epsilon_2 \epsilon_1] &amp; E[\epsilon_2^2] &amp; \dots &amp; E[\epsilon_2 \epsilon_n] \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\ 
E[\epsilon_n \epsilon_1] &amp; E[\epsilon_n \epsilon_2] &amp; \dots &amp; E[\epsilon_n^2]
\end{bmatrix}
\end{aligned}
\end{equation}\]</span>
<p>Recall, the regression assumption that the errors <span class="math inline">\(\epsilon_i&#39;s\)</span> are Normally distributed with mean 0 and variance <span class="math inline">\(\sigma^2\)</span>. Thus, <span class="math inline">\(E(\epsilon_i^2) = Var(\epsilon_i) = \sigma^2\)</span> for all <span class="math inline">\(i\)</span>. Additionally, recall the regression assumption that the errors are uncorrelated, i.e. <span class="math inline">\(E(\epsilon_i \epsilon_j) = Cov(\epsilon_i, \epsilon_j) = 0\)</span> for all <span class="math inline">\(i,j\)</span>. Using these assumptions, we can write () as</p>
<span class="math display">\[\begin{equation}
E[\mathbf{\epsilon}\mathbf{\epsilon}^T]  = \begin{bmatrix} \sigma^2  &amp; 0 &amp; \dots &amp; 0 \\
0 &amp; \sigma^2  &amp; \dots &amp; 0 \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
0 &amp; 0 &amp; \dots &amp; \sigma^2
\end{bmatrix} = \sigma^2 \mathbf{I}
\end{equation}\]</span>
<p>where <span class="math inline">\(\mathbf{I}\)</span> is the <span class="math inline">\(n \times n\)</span> identity matrix.</p>
<p>Next, we show that <span class="math inline">\(\hat{\boldsymbol{\beta}} = \boldsymbol{\beta} + (\mathbf{X}^T\mathbf{X})^{-1}\epsilon\)</span>.</p>
<p>Recall that the <span class="math inline">\(\hat{\boldsymbol{\beta}} = (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{Y}\)</span> and <span class="math inline">\(\mathbf{Y} = \mathbf{X}\mathbf{\beta} + \mathbf{\epsilon}\)</span>. Then,</p>
<span class="math display">\[\begin{equation}
\begin{aligned}
\hat{\boldsymbol{\beta}} &amp;= (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{Y} \\[10pt]
&amp;= (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T(\mathbf{X}\boldsymbol{\beta} + \boldsymbol{\epsilon}) \\[10pt]
&amp;= \boldsymbol{\beta} + (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T \mathbf{\epsilon} \\
\end{aligned}
\end{equation}\]</span>
<p>Using these two properties, we derive the form of the variance-covariance matrix for the coefficients. Note that the covariance matrix is <span class="math inline">\(E[(\hat{\boldsymbol{\beta}} - \boldsymbol{\beta})(\hat{\boldsymbol{\beta}} - \boldsymbol{\beta})^T]\)</span></p>
<span class="math display">\[\begin{equation}
\begin{aligned}
E[(\hat{\boldsymbol{\beta}} - \boldsymbol{\beta})(\hat{\boldsymbol{\beta}} - \boldsymbol{\beta})^T] &amp;= E[(\boldsymbol{\beta} + (\mathbf{X}^T\mathbf{X})^{-1} \mathbf{X}^T \boldsymbol{\epsilon} - \boldsymbol{\beta})(\boldsymbol{\beta} + (\mathbf{X}^T\mathbf{X})^{-1} \mathbf{X}^T \boldsymbol{\epsilon} - \boldsymbol{\beta})^T]\\[10pt]
&amp; = E[(\mathbf{X}^T\mathbf{X})^{-1} \mathbf{X}^T \boldsymbol{\epsilon}\boldsymbol{\epsilon}^T\mathbf{X}(\mathbf{X}^T\mathbf{X})^{-1}] \\[10pt]
&amp; = (\mathbf{X}^T\mathbf{X})^{-1} \mathbf{X}^T E[\boldsymbol{\epsilon}\boldsymbol{\epsilon}^T]\mathbf{X}(\mathbf{X}^T\mathbf{X})^{-1}\\[10pt]
&amp; = (\mathbf{X}^T\mathbf{X})^{-1} \mathbf{X}^T (\sigma^2\mathbf{I})\mathbf{X}(\mathbf{X}^T\mathbf{X})^{-1}\\
&amp;= \sigma^2\mathbf{I}(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{X}(\mathbf{X}^T\mathbf{X})^{-1}\\[10pt]
&amp; = \sigma^2\mathbf{I}(\mathbf{X}^T\mathbf{X})^{-1}\\[10pt]
&amp;  = \sigma^2(\mathbf{X}^T\mathbf{X})^{-1} \\
\end{aligned}
\end{equation}\]</span>

</div>
<div id="log-transformations-in-linear-regression" class="section level2">
<h2><span class="header-section-number">10.48</span> Log Transformations in Linear Regression</h2>
<p>This document provides details about the model interpretion when the predictor and/or response variables are log-transformed. For simplicity, we will discuss transformations for the simple linear regression model:</p>
<span class="math display">\[\begin{equation}
\label{orig}
y = \beta_0 + \beta_1 x
\end{equation}\]</span>
<p>All results and interpretations can be easily extended to transformations in multiple regression models.</p>
<p><em>Note</em>: <em>log</em> refers to the natural logarithm.</p>
</div>
<div id="log-transformation-on-the-response-variable" class="section level2">
<h2><span class="header-section-number">10.49</span> Log-transformation on the response variable</h2>
<p>Suppose we fit a linear regression model with <span class="math inline">\(\log(y)\)</span>, the log-transformed <span class="math inline">\(y\)</span>, as the response variable. Under this model, we assume a linear relationship exists between <span class="math inline">\(x\)</span> and <span class="math inline">\(\log(y)\)</span>, such that <span class="math inline">\(\log(y) \sim N(\beta_0 + \beta_1 x, \sigma^2)\)</span> for some <span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\sigma^2\)</span>. In other words, we can model the relationship between <span class="math inline">\(x\)</span> and <span class="math inline">\(\log(y)\)</span> using the model in ().</p>
<span class="math display">\[\begin{equation}
\label{log-y}
\log(y) = \beta_0 + \beta_1 x
\end{equation}\]</span>
<p>If we interpret the model in terms of <span class="math inline">\(\log(y)\)</span>, then we can use the usual interpretations for slope and intercept. When reporting results, however, it is best to give all interpretations in terms of the original response variable <span class="math inline">\(y\)</span>, since interpretations using log-transformed variables are often more difficult to truly understand.</p>
<p>In order to get back on the original scale, we need to use the exponential function (also known as the anti-log), <span class="math inline">\(\exp\{x\} = e^x\)</span>. Therefore, we use the model in () for interpretations and predictions, we will use () to state our conclusions in terms of <span class="math inline">\(y\)</span>.</p>
<span class="math display">\[\begin{equation}
\label{exp-y}
\begin{aligned}
&amp;\exp\{\log(y)\} = \exp\{\beta_0 + \beta_1 x\} \\[10pt]
\Rightarrow &amp;y = \exp\{\beta_0 + \beta_1 x\} \\[10pt]
\Rightarrow &amp;y = \exp\{\beta_0\}\exp\{\beta_1 x\}
\end{aligned}
\end{equation}\]</span>
<p>In order to interpret the slope and intercept, we need to first understand the relationship between the mean, median and log transformations.</p>
<div id="mean-median-and-log-transformations" class="section level3">
<h3><span class="header-section-number">10.49.1</span> Mean, Median, and Log Transformations</h3>
<p>Suppose we have a dataset <code>y</code> that contains the following observations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>)
y</code></pre></div>
<p>If we log-transform the values of <code>y</code> then calculate the mean and median, we have</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">log_y &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">log_y =</span> <span class="kw">log</span>(y))
summary &lt;-<span class="st"> </span>log_y <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_log_y =</span> <span class="kw">mean</span>(log_y), <span class="dt">median_log_y =</span> <span class="kw">median</span>(log_y))
<span class="kw">kable</span>(summary,<span class="dt">digits=</span><span class="dv">5</span>)</code></pre></div>
<p>If we calculate the mean and median of <code>y</code>, then log-transform the mean and median, we have</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">centers &lt;-<span class="st"> </span><span class="kw">tibble</span>(y) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">mean_y =</span> <span class="kw">mean</span>(y), <span class="dt">median_y =</span> <span class="kw">median</span>(y))
summary2 &lt;-<span class="st"> </span>centers <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">log_mean =</span> <span class="kw">log</span>(mean_y), <span class="dt">log_median =</span> <span class="kw">log</span>(median_y))
<span class="kw">kable</span>(summary2,<span class="dt">digits=</span><span class="dv">5</span>)</code></pre></div>
<p>This is a simple illustration to show</p>
<ol style="list-style-type: decimal">
<li><p><span class="math inline">\(\text{Mean}[{\log(y)}] \neq \log[\text{Mean}(y)]\)</span> - the mean and log are not commutable</p></li>
<li><p><span class="math inline">\(\text{Median}[\log(y)] = \log[\text{Median}(y)]\)</span> - the median and log are commutable</p></li>
</ol>
</div>
<div id="interpretaton-of-model-coefficients" class="section level3">
<h3><span class="header-section-number">10.49.2</span> Interpretaton of model coefficients</h3>
<p>Using (), the mean <span class="math inline">\(\log(y)\)</span> for any given value of <span class="math inline">\(x\)</span> is <span class="math inline">\(\beta_0 + \beta_1 x\)</span>; however, this does <strong>not</strong> indicate that the mean of <span class="math inline">\(y = \exp\{\beta_0 + \beta_1 x\}\)</span> (see previous section). From the assumptions of linear regression, we assume that for any given value of <span class="math inline">\(x\)</span>, the distribution of <span class="math inline">\(\log(y)\)</span> is Normal, and therefore symmetric. Thus the median of <span class="math inline">\(\log(y)\)</span> is equal to the mean of <span class="math inline">\(\log(y)\)</span>, i.e <span class="math inline">\(\text{Median}(\log(y)) = \beta_0 + \beta_1 x\)</span>.</p>
<p>Since the log and the median are commutable, <span class="math inline">\(\text{Median}(\log(y)) = \beta_0 + \beta_1 x \Rightarrow \text{Median}(y) = \exp\{\beta_0 + \beta_1 x\}\)</span>. Thus, when we log-transform the response variable, the interpretation of the intercept and slope are in terms of the effect on the <strong>median</strong> of <span class="math inline">\(y\)</span>.</p>
<p><strong>Intercept</strong>: The intercept is expected median of <span class="math inline">\(y\)</span> when the predictor variable equals 0. Therefore, when <span class="math inline">\(x=0\)</span>,</p>
<span class="math display">\[\begin{equation}
\begin{aligned}
&amp;\log(y) = \beta_0 + \beta_1 \times 0 = \beta_0 \\[10pt]
\Rightarrow &amp;y = \exp\{\beta_0\}
\end{aligned}
\end{equation}\]</span>
<p><em>Interpretation: When <span class="math inline">\(x=0\)</span>, the median of <span class="math inline">\(y\)</span> is expected to be <span class="math inline">\(\exp\{\beta_0\}\)</span>.</em></p>
<p><strong>Slope</strong>: The slope is the expected change in the median of <span class="math inline">\(y\)</span> when <span class="math inline">\(x\)</span> increases by 1 unit. The change in the median of <span class="math inline">\(y\)</span> is</p>
<span class="math display">\[\begin{equation}
\exp\{[\beta_0 + \beta_1 (x+1)] - [\beta_0 + \beta_1 x]\} = \frac{\exp\{\beta_0 + \beta_1 (x+1)\}}{\exp\{\beta_0 + \beta_1 x\}} = \frac{\exp\{\beta_0\}\exp\{\beta_1 x\}\exp\{\beta_1\}}{\exp\{\beta_0\}\exp\{\beta_1 x\}} = \exp\{\beta_1\}
\end{equation}\]</span>
<p>Thus, the median of <span class="math inline">\(y\)</span> for <span class="math inline">\(x+1\)</span> is <span class="math inline">\(\exp\{\beta_1\}\)</span> times the median of <span class="math inline">\(y\)</span> for <span class="math inline">\(x\)</span>.</p>
<p><em>Interpretation: When <span class="math inline">\(x\)</span> increases by one unit, the median of <span class="math inline">\(y\)</span> is expected to multiply by a factor of <span class="math inline">\(\exp\{\beta_1\}\)</span>.</em></p>
</div>
</div>
<div id="log-transformation-on-the-predictor-variable" class="section level2">
<h2><span class="header-section-number">10.50</span> Log-transformation on the predictor variable</h2>
<p>Suppose we fit a linear regression model with <span class="math inline">\(\log(x)\)</span>, the log-transformed <span class="math inline">\(x\)</span>, as the predictor variable. Under this model, we assume a linear relationship exists between <span class="math inline">\(\log(x)\)</span> and <span class="math inline">\(y\)</span>, such that <span class="math inline">\(y \sim N(\beta_0 + \beta_1 \log(x), \sigma^2)\)</span> for some <span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\sigma^2\)</span>. In other words, we can model the relationship between <span class="math inline">\(\log(x)\)</span> and <span class="math inline">\(y\)</span> using the model in ().</p>
<span class="math display">\[\begin{equation}
\label{log-x}
y = \beta_0 + \beta_1 \log(x)
\end{equation}\]</span>
<p><strong>Intercept</strong>: The intercept is the mean of <span class="math inline">\(y\)</span> when <span class="math inline">\(\log(x) = 0\)</span>, i.e. <span class="math inline">\(x = 1\)</span>.</p>
<p><em>Interpretation: When <span class="math inline">\(x = 1\)</span> <span class="math inline">\((\log(x) = 0)\)</span>, the mean of <span class="math inline">\(y\)</span> is expected to be <span class="math inline">\(\beta_0\)</span>.</em></p>
<p><strong>Slope</strong>: The slope is interpreted in terms of the change in the mean of <span class="math inline">\(y\)</span> when <span class="math inline">\(x\)</span> is mutliplied by a factor of <span class="math inline">\(C\)</span>, since <span class="math inline">\(\log(Cx) = \log(x) + \log(C)\)</span>. Thus, when <span class="math inline">\(x\)</span> is multiplied by a factor of <span class="math inline">\(C\)</span>, the change in the mean of <span class="math inline">\(y\)</span> is</p>
<span class="math display">\[\begin{equation}
\begin{aligned}
[\beta_0 + \beta_1 \log(Cx)] - [\beta_0 + \beta_1 \log(x)] &amp;= \beta_1 [\log(Cx) - \log(x)] \\[10pt] 
&amp; = \beta_1[\log(C) + \log(x) - \log(x)] \\[10pt] 
&amp; = \beta_1 \log(C)
\end{aligned}
\end{equation}\]</span>
<p>Thus the mean of <span class="math inline">\(y\)</span> changes by <span class="math inline">\(\beta_1 \log(C)\)</span> units.</p>
<p><em>Interpretation: When <span class="math inline">\(x\)</span> is multiplied by a factor of <span class="math inline">\(C\)</span>, the mean of <span class="math inline">\(y\)</span> is expected to change by <span class="math inline">\(\beta_1 \log(C)\)</span> units. For example, if <span class="math inline">\(x\)</span> is doubled, then the mean of <span class="math inline">\(y\)</span> is expected to change by <span class="math inline">\(\beta_1 \log(2)\)</span> units.</em></p>
</div>
<div id="log-transformation-on-the-the-response-and-predictor-variable" class="section level2">
<h2><span class="header-section-number">10.51</span> Log-transformation on the the response and predictor variable</h2>
<p>Suppose we fit a linear regression model with <span class="math inline">\(\log(x)\)</span>, the log-transformed <span class="math inline">\(x\)</span>, as the predictor variable and <span class="math inline">\(\log(y)\)</span>, the log-transformed <span class="math inline">\(y\)</span>, as the response variable. Under this model, we assume a linear relationship exists between <span class="math inline">\(\log(x)\)</span> and <span class="math inline">\(\log(y)\)</span>, such that <span class="math inline">\(\log(y) \sim N(\beta_0 + \beta_1 \log(x), \sigma^2)\)</span> for some <span class="math inline">\(\beta_0\)</span>, <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\sigma^2\)</span>. In other words, we can model the relationship between <span class="math inline">\(\log(x)\)</span> and <span class="math inline">\(\log(y)\)</span> using the model in ().</p>
<span class="math display">\[\begin{equation}
\label{log-x-y}
\log(y) = \beta_0 + \beta_1 \log(x)
\end{equation}\]</span>
<p>Because the response variable is log-transformed, the interpretations on the original scale will be in terms of the median of <span class="math inline">\(y\)</span> (see the section on the log-transformed response variable for more detail).</p>
<p><strong>Intercept</strong>: The intercept is the mean of <span class="math inline">\(y\)</span> when <span class="math inline">\(\log(x) = 0\)</span>, i.e. <span class="math inline">\(x = 1\)</span>. Therefore, when <span class="math inline">\(\log(x) = 0\)</span>,</p>
<span class="math display">\[\begin{equation}
\begin{aligned}
&amp;\log(y) = \beta_0 + \beta_1 \times 0 = \beta_0 \\[10pt]
\Rightarrow &amp;y = \exp\{\beta_0\}
\end{aligned}
\end{equation}\]</span>
<p><em>Interpretation: When <span class="math inline">\(x = 1\)</span> <span class="math inline">\((\log(x) = 0)\)</span>, the median of <span class="math inline">\(y\)</span> is expected to be <span class="math inline">\(\exp\{\beta_0\}\)</span>.</em></p>
<p><strong>Slope</strong>: The slope is interpreted in terms of the change in the median <span class="math inline">\(y\)</span> when <span class="math inline">\(x\)</span> is mutliplied by a factor of <span class="math inline">\(C\)</span>, since <span class="math inline">\(\log(Cx) = \log(x) + \log(C)\)</span>. Thus, when <span class="math inline">\(x\)</span> is multiplied by a factor of <span class="math inline">\(C\)</span>, the change in the median of <span class="math inline">\(y\)</span> is</p>
<span class="math display">\[\begin{equation}
\begin{aligned}
\exp\{[\beta_0 + \beta_1 \log(Cx)] - [\beta_0 + \beta_1 \log(x)]\} &amp;= 
\exp\{\beta_1 [\log(Cx) - \log(x)]\} \\[10pt] 
&amp; = \exp\{\beta_1[\log(C) + \log(x) - \log(x)]\} \\[10pt] 
&amp; = \exp\{\beta_1 \log(C)\} = C^{\beta_1}
\end{aligned}
\end{equation}\]</span>
<p>Thus, the median of <span class="math inline">\(y\)</span> for <span class="math inline">\(Cx\)</span> is <span class="math inline">\(C^{\beta_1}\)</span> times the median of <span class="math inline">\(y\)</span> for <span class="math inline">\(x\)</span>.</p>
<p><em>Interpretation: When <span class="math inline">\(x\)</span> is multiplied by a factor of <span class="math inline">\(C\)</span>, the median of <span class="math inline">\(y\)</span> is expected to multiple by a factor of <span class="math inline">\(C^{\beta_1}\)</span>. For example, if <span class="math inline">\(x\)</span> is doubled, then the median of <span class="math inline">\(y\)</span> is expected to multiply by <span class="math inline">\(2^{\beta_1}\)</span>.</em></p>

</div>
<div id="details-about-model-diagnostics" class="section level2">
<h2><span class="header-section-number">10.52</span> Details about Model Diagnostics</h2>
<p>This document discusses some of the mathematical details of the model diagnostics - leverage, standardized residuals, and Cook’s distance. We assume the reader knowledge of the matrix form for multiple linear regression.Please see <a href="https://github.com/STA210-Sp19/supplemental-notes/blob/master/regression-basics-matrix.pdf">Matrix Form of Linear Regression</a> for a review.</p>
</div>
<div id="introduction-2" class="section level2">
<h2><span class="header-section-number">10.53</span> Introduction</h2>
<p>Suppose we have <span class="math inline">\(n\)</span> observations. Let the <span class="math inline">\(i^{th}\)</span> be <span class="math inline">\((x_{i1}, \ldots, x_{ip}, y_i)\)</span>, such that <span class="math inline">\(x_{i1}, \ldots, x_{ip}\)</span> are the explanatory variables (predictors) and <span class="math inline">\(y_i\)</span> is the response variable. We assume the data can be modeled using the least-squares regression model, such that the mean response for a given combination of explanatory variables follows the form in ().</p>
<span class="math display">\[\begin{equation}
\label{basic_model}
y = \beta_0 + \beta_1 x_1 + \dots + \beta_p x_p 
\end{equation}\]</span>
<p>We can write the response for the <span class="math inline">\(i^{th}\)</span> observation as shown in ()</p>
<span class="math display">\[\begin{equation}
\label{ind_response}
y_i = \beta_0 + \beta_1 x_{i1} + \dots + \beta_p x_{ip} + \epsilon_i 
\end{equation}\]</span>
<p>such that <span class="math inline">\(\epsilon_i\)</span> is the amount <span class="math inline">\(y_i\)</span> deviates from <span class="math inline">\(\mu\{y|x_{i1}, \ldots, x_{ip}\}\)</span>, the mean response for a given combination of explanatory variables. We assume each <span class="math inline">\(\epsilon_i \sim N(0,\sigma^2)\)</span>, where <span class="math inline">\(\sigma^2\)</span> is a constant variance for the distribution of the response <span class="math inline">\(y\)</span> for any combination of explanatory variables <span class="math inline">\(x_1, \ldots, x_p\)</span>.</p>
</div>
<div id="matrix-form-for-the-regression-model-1" class="section level2">
<h2><span class="header-section-number">10.54</span> Matrix Form for the Regression Model</h2>
<p>We can represent the () and () using matrix notation. Let</p>
<span class="math display">\[\begin{equation}
\label{matrix notation}
\mathbf{Y} = \begin{bmatrix}y_1 \\ y_2 \\ \vdots \\y_n\end{bmatrix} 
\hspace{15mm}
\mathbf{X} = \begin{bmatrix}x_{11} &amp; x_{12} &amp; \dots &amp; x_{1p} \\
x_{21} &amp; x_{22} &amp; \dots &amp; x_{2p} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots\\
x_{n1} &amp; x_{n2} &amp; \dots &amp; x_{np} \end{bmatrix}
\hspace{15mm}
\boldsymbol{\beta}= \begin{bmatrix}\beta_0 \\ \beta_1 \\ \vdots \\ \beta_p \end{bmatrix} 
\hspace{15mm}
\boldsymbol{\epsilon}= \begin{bmatrix}\epsilon_1 \\ \epsilon_2 \\ \vdots \\ \epsilon_n \end{bmatrix}
\end{equation}\]</span>
<p>Thus,</p>
<p><span class="math display">\[\mathbf{Y} = \mathbf{X}\boldsymbol{\beta} + \mathbf{\epsilon}\]</span></p>
<p>Therefore the estimated response for a given combination of explanatory variables and the associated residuals can be written as</p>
<span class="math display">\[\begin{equation}
\label{matrix_mean}
\hat{\mathbf{Y}} = \mathbf{X}\hat{\boldsymbol{\beta}} \hspace{10mm} \mathbf{e} = \mathbf{Y} - \mathbf{X}\hat{\boldsymbol{\beta}}
\end{equation}\]</span>
</div>
<div id="hat-matrix-leverage" class="section level2">
<h2><span class="header-section-number">10.55</span> Hat Matrix &amp; Leverage</h2>
<p>Recall from the notes <a href="https://github.com/STA210-Sp19/supplemental-notes/blob/master/regression-basics-matrix.pdf"><strong>Matrix Form of Linear Regression</strong></a> that <span class="math inline">\(\hat{\boldsymbol{\beta}}\)</span> can be written as the following:</p>
<span class="math display">\[\begin{equation}
\label{beta-hat}
\hat{\boldsymbol{\beta}} = (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{Y}
\end{equation}\]</span>
<p>Combining () and (), we can write <span class="math inline">\(\hat{\mathbf{Y}}\)</span> as the following:</p>
<span class="math display">\[\begin{equation}
\label{y-hat}
\begin{aligned}
\hat{\mathbf{Y}} &amp;= \mathbf{X}\hat{\boldsymbol{\beta}} \\[10pt]
&amp;= \mathbf{X}(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{Y}\\
\end{aligned}
\end{equation}\]</span>
<p>We define the <strong>hat matrix</strong> as an <span class="math inline">\(n \times n\)</span> matrix of the form <span class="math inline">\(\mathbf{H} = \mathbf{X}(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\)</span>. Thus () becomes</p>
<span class="math display">\[\begin{equation}
\label{y-hat-matrix}
\hat{\mathbf{Y}} = \mathbf{H}\mathbf{Y}
\end{equation}\]</span>
<p>The diagonal elements of the hat matrix are a measure of how far the predictor variables of each observation are from the means of the predictor variables. For example, <span class="math inline">\(h_{ii}\)</span> is a measure of how far the values of the predictor variables for the <span class="math inline">\(i^{th}\)</span> observation, <span class="math inline">\(x_{i1}, x_{i2}, \ldots, x_{ip}\)</span>, are from the mean values of the predictor variables, <span class="math inline">\(\bar{x}_1, \bar{x}_2, \ldots, \bar{x}_p\)</span>. In the case of simple linear regression, the <span class="math inline">\(i^{th}\)</span> diagonal, <span class="math inline">\(h_{ii}\)</span>, can be written as</p>
<p><span class="math display">\[h_{ii} =  \frac{1}{n} + \frac{(x_i - \bar{x})^2}{\sum_{j=1}^{n}(x_j-\bar{x})^2}\]</span></p>
<p>We call these diagonal elements, the <strong>leverage</strong> of each observation.</p>
<p>The diagonal elements of the hat matrix have the following properties:</p>
<ul>
<li><span class="math inline">\(0 \leq h_ii \leq 1\)</span></li>
<li><span class="math inline">\(\sum\limits_{i=1}^{n} h_{ii} = p+1\)</span>, where <span class="math inline">\(p\)</span> is the number of predictor variables in the model.</li>
<li>The mean hat value is <span class="math inline">\(\bar{h} = \frac{\sum\limits_{i=1}^{n} h_{ii}}{n} = \frac{p+1}{n}\)</span>.</li>
</ul>
<p>Using these properties, we consider a point to have <strong>high leverage</strong> if it has a leverage value that is more than 2 times the average. In other words, observations with leverage greater than <span class="math inline">\(\frac{2(p+1)}{n}\)</span> are considered to be <strong>high leverage</strong> points, i.e. outliers in the predictor variables. We are interested in flagging high leverage points, because they may have an influence on the regression coefficients.</p>
<p>When there are high leverage points in the data, the regression line will tend towards those points; therefore, one property of high leverage points is that they tend to have small residuals. We will show this by rewriting the residuals from () using ().</p>
<span class="math display">\[\begin{equation}
\label{resid-hat}
\begin{aligned}
\mathbf{e} &amp;= \mathbf{Y} - \hat{\mathbf{Y}} \\[10pt]
&amp; = \mathbf{Y} - \mathbf{H}\mathbf{Y} \\[10pt]
&amp;= (1-\mathbf{H})\mathbf{Y}
\end{aligned}
\end{equation}\]</span>
<p>Note that the identity matrix and hat matrix are <strong>idempotent</strong>, i.e. <span class="math inline">\(\mathbf{I}\mathbf{I} = \mathbf{I}\)</span>, <span class="math inline">\(\mathbf{H}\mathbf{H} = \mathbf{H}\)</span>. Thus, <span class="math inline">\((\mathbf{I} - \mathbf{H}\)</span> is also idempotent. These matrices are also symmetric. Using these properties and (), we have that the variance-covariance matrix of the residuals <span class="math inline">\(\boldsymbol{e}\)</span>, is</p>
<span class="math display">\[\begin{equation}
\label{resid-var}
\begin{aligned}
Var(\mathbf{e}) &amp;= \mathbf{e}\mathbf{e}^T \\[10pt]
&amp;=  (1-\mathbf{H})Var(\mathbf{Y})^T(1-\mathbf{H})^T \\[10pt]
&amp;= (1-\mathbf{H})\hat{\sigma}^2(1-\mathbf{H})^T  \\[10pt]
&amp;= \hat{\sigma}^2(1-\mathbf{H})(1-\mathbf{H})  \\[10pt]
&amp;= \hat{\sigma}^2(1-\mathbf{H})
\end{aligned}
\end{equation}\]</span>
<p>where <span class="math inline">\(\hat{\sigma}^2 = \frac{\sum_{i=1}^{n}e_i^2}{n-p-1}\)</span> is the estimated regression variance. Thus, the variance of the <span class="math inline">\(i^{th}\)</span> residual is <span class="math inline">\(Var(e_i) = \hat{\sigma}^2(1-h_{ii})\)</span>. Therefore, the higher the leverage, the smaller the variance of the residual. Because the expected value of the residuals is 0, we conclude that points with high leverage tend to have smaller residuals than points with lower leverage.</p>
</div>
<div id="standardized-residuals" class="section level2">
<h2><span class="header-section-number">10.56</span> Standardized Residuals</h2>
<p>In general, we standardize a value by shifting by the expected value and rescaling by the standard deviation (or standard error). Thus, the <span class="math inline">\(i^{th}\)</span> standardized residual takes the form</p>
<p><span class="math display">\[std.res_i = \frac{e_i - E(e_i)}{SE(e_i)}\]</span></p>
<p>The expected value of the residuals is 0, i.e. <span class="math inline">\(E(e_i) = 0\)</span>. From (), the standard error of the residual is <span class="math inline">\(SE(e_i) = \hat{\sigma}\sqrt{1-h_{ii}}\)</span>. Therefore,</p>
<span class="math display">\[\begin{equation}
\label{std.resid.}
std.res_i = \frac{e_i}{\hat{\sigma}\sqrt{1-h_{ii}}}
\end{equation}\]</span>
</div>
<div id="cooks-distance" class="section level2">
<h2><span class="header-section-number">10.57</span> Cook’s Distance</h2>
<p>Cook’s distance is a measure of how much each observation influences the model coefficients, and thus the predicted values. The Cook’s distance for the <span class="math inline">\(i^{th}\)</span> observation can be written as</p>
<span class="math display">\[\begin{equation}
\label{cooksd}
D_i = \frac{(\hat{\mathbf{Y}} -\hat{\mathbf{Y}}_{(i)})^T(\hat{\mathbf{Y}} -\hat{\mathbf{Y}}_{(i)})}{(p+1)\hat{\sigma}}
\end{equation}\]</span>
<p>where <span class="math inline">\(\hat{\mathbf{Y}}_{(i)}\)</span> is the vector of predicted values from the model fitted when the <span class="math inline">\(i^{th}\)</span> observation is deleted. Cook’s Distance can be calculated without deleting observations one at a time, since () below is mathematically equivalent to ().</p>
<span class="math display">\[\begin{equation}
\label{cooksd-v2}
D_i = \frac{1}{p+1}std.res_i^2\Bigg[\frac{h_{ii}}{(1-h_{ii})}\Bigg] = \frac{e_i^2}{(p+1)\hat{\sigma}^2(1-h_{ii})}\Bigg[\frac{h_{ii}}{(1-h_{ii})}\Bigg]
\end{equation}\]</span>

</div>
<div id="model-selection-criteria-aic-bic" class="section level2">
<h2><span class="header-section-number">10.58</span> Model Selection Criteria: AIC &amp; BIC</h2>
<p>This document discusses some of the mathematical details of Akaike’s Information Criterion (AIC) and Schwarz’s Bayesian Information Criterion (BIC). We assume the reader knowledge of the matrix form for multiple linear regression.Please see <a href="https://github.com/STA210-Sp19/supplemental-notes/blob/master/regression-basics-matrix.pdf">Matrix Form of Linear Regression</a> for a review.</p>
</div>
<div id="maximum-likelihood-estimation-of-boldsymbolbeta-and-sigma" class="section level2">
<h2><span class="header-section-number">10.59</span> Maximum Likelihood Estimation of <span class="math inline">\(\boldsymbol{\beta}\)</span> and <span class="math inline">\(\sigma\)</span></h2>
<p>To understand the formulas for AIC and BIC, we will first briefly explain the likelihood function and maximum likelihood estimates for regression.</p>
<p>Let <span class="math inline">\(\mathbf{Y}\)</span> be <span class="math inline">\(n \times 1\)</span> matrix of responses, <span class="math inline">\(\mathbf{X}\)</span>, the <span class="math inline">\(n \times (p+1)\)</span> matrix of predictors, and <span class="math inline">\(\boldsymbol{\beta}\)</span>, <span class="math inline">\((p+1) \times 1\)</span> matrix of coefficients. If the multiple linear regression model is correct then,</p>
<span class="math display">\[\begin{equation}
\label{norm-assumption}
\mathbf{Y} \sim N(\mathbf{X}\boldsymbol{\beta}, \sigma^2)
\end{equation}\]</span>
<p>When we do linear regression, our goal is to estimate the unknown parameters <span class="math inline">\(\boldsymbol{\beta}\)</span> and <span class="math inline">\(\sigma^2\)</span> from (). In <a href="https://github.com/STA210-Sp19/supplemental-notes/blob/master/regression-basics-matrix.pdf">Matrix Form of Linear Regression</a>, we showed a way to estimate these parameters using matrix alegbra. Another approach for estimating <span class="math inline">\(\boldsymbol{\beta}\)</span> and <span class="math inline">\(\sigma^2\)</span> is using <em>maximum likelihood estimation</em>.</p>
<p>A <strong>likelihood function</strong> is used to summarise the evidence from the data in support of each possible value of a model parameter. Using (), we will write the likelihood function for linear regression as</p>
<span class="math display">\[\begin{equation}
\label{lr}
L(\mathbf{X}, \mathbf{Y}|\boldsymbol{\beta}, \sigma^2) = \prod\limits_{i=1}^n (2\pi \sigma^2)^{-\frac{1}{2}} \exp\bigg\{-\frac{1}{2\sigma^2}\sum\limits_{i=1}^n(Y_i - \mathbf{X}_i \boldsymbol{\beta})^T(Y_i - \mathbf{X}_i \boldsymbol{\beta})\bigg\}
\end{equation}\]</span>
<p>where <span class="math inline">\(Y_i\)</span> is the <span class="math inline">\(i^{th}\)</span> response and <span class="math inline">\(\mathbf{X}_i\)</span> is the vector of predictors for the <span class="math inline">\(i^{th}\)</span> observation. One approach estimating <span class="math inline">\(\boldsymbol{\beta}\)</span> and <span class="math inline">\(\sigma^2\)</span> is to find the values of those parameters that maximize the likelihood in (), i.e. <strong>maximum likelhood estimation</strong>. To make the calculations more manageable, instead of maximizing the likelihood function, we will instead maximize its logarithm, i.e. the log-likelihood function. The values of the parameters that maximize the log-likelihood function are those that maximize the likelihood function. The log-likelihood function we will maximize is</p>
<span class="math display">\[\begin{equation}
\label{logL}
\begin{aligned}
\log L(\mathbf{X}, \mathbf{Y}|\boldsymbol{\beta}, \sigma^2) &amp;= \sum\limits_{i=1}^n -\frac{1}{2}\log(2\pi\sigma^2) -\frac{1}{2\sigma^2}\sum\limits_{i=1}^n(Y_i - \mathbf{X}_i \boldsymbol{\beta})^T(Y_i - \mathbf{X}_i \boldsymbol{\beta}) \\[10pt]
&amp;= -\frac{n}{2}\log(2\pi\sigma^2) - \frac{1}{2\sigma^2}(\mathbf{Y} - \mathbf{X} \boldsymbol{\beta})^T(\mathbf{Y} - \mathbf{X} \boldsymbol{\beta})\\
\end{aligned}
\end{equation}\]</span>
<p>[–insert details MLES–]</p>
<p>The maximum likelihood estimate of <span class="math inline">\(\boldsymbol{\beta}\)</span> and <span class="math inline">\(\sigma^2\)</span> are</p>
<span class="math display">\[\begin{equation}
\label{mle}
\hat{\boldsymbol{\beta}} = (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{Y} \hspace{10mm} \hat{\sigma}^2 = \frac{1}{n}(\mathbf{Y} - \mathbf{X} \boldsymbol{\beta})^T(\mathbf{Y} - \mathbf{X} \boldsymbol{\beta}) = \frac{1}{n}RSS
\end{equation}\]</span>
<p>where <span class="math inline">\(RSS\)</span> is the residual sum of squares. Note that the maximum likelihood estimate is not exactly equal to the estimate of <span class="math inline">\(\sigma^2\)</span> we typically use <span class="math inline">\(\frac{RSS}{n-p-1}\)</span>. This is because the maximum likelihood estimate of <span class="math inline">\(\sigma^2\)</span> in () is a <em>biased</em> estimator of <span class="math inline">\(\sigma^2\)</span>. When <span class="math inline">\(n\)</span> is much larger than the number of predictors <span class="math inline">\(p\)</span>, then the differences in these two estimates are trivial.</p>
</div>
<div id="aic" class="section level2">
<h2><span class="header-section-number">10.60</span> AIC</h2>
<p>Akaike’s Information Criterion (AIC) is</p>
<span class="math display">\[\begin{equation}
\label{aic}
AIC = -2 \log L + 2(p+1)
\end{equation}\]</span>
<p>where <span class="math inline">\(\log L\)</span> is the log-likelihood. This is the general form of AIC that can be applied to a variety of models, but for now, let’s focus on AIC for mutliple linear regression.</p>
<span class="math display">\[\begin{equation}
\label{aic-reg}
\begin{aligned}
AIC &amp;= -2 \log L + 2(p+1) \\[10pt]
&amp;= -2\bigg[-\frac{n}{2}\log(2\pi\sigma^2) - \frac{1}{2\sigma^2}(\mathbf{Y} - \mathbf{X} \boldsymbol{\beta})^T(\mathbf{Y} - \mathbf{X} \boldsymbol{\beta})\bigg] + 2(p+1) \\[10pt]
&amp;= n\log\big(2\pi\frac{RSS}{n}\big) + \frac{1}{RSS/n}RSS \\[10pt]
&amp;= n\log(2\pi) + n\log(RSS) - n\log(n) + 2(p+1)
\end{aligned}
\end{equation}\]</span>
</div>
<div id="bic" class="section level2">
<h2><span class="header-section-number">10.61</span> BIC</h2>
<p>[—]</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="special.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["intro-regression.pdf", "intro-regression.epub"],
"toc": {
"collapse": "subsection",
"depth": 1,
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
